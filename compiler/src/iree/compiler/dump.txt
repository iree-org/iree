b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800    1) // Copyright 2021 The IREE Authors
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800    2) //
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800    3) // Licensed under the Apache License v2.0 with LLVM Exceptions.
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800    4) // See https://llvm.org/LICENSE.txt for license information.
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800    5) // SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800    6) 
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800    7) #include "iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.h"
b7c415254fe compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-03-09 18:49:50 +0000    8) 
a6a56a97ae0 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-05-28 12:35:45 -0700    9) #include "iree/compiler/Dialect/LinalgExt/IR/LinalgExtInterfaces.h"
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100   10) #include "iree/compiler/Dialect/LinalgExt/Utils/IndexingUtils.h"
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800   11) #include "iree/compiler/Dialect/LinalgExt/Utils/Utils.h"
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800   12) #include "llvm/ADT/STLExtras.h"
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800   13) #include "llvm/ADT/SetVector.h"
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800   14) #include "llvm/ADT/SmallVector.h"
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800   15) #include "llvm/ADT/TypeSwitch.h"
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700   16) #include "llvm/Support/Debug.h"
ac418d1f45d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Lei Zhang          2024-06-20 19:24:08 -0700   17) #include "llvm/Support/MathExtras.h"
8128e961889 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-09-25 06:22:47 +0800   18) #include "mlir/Dialect/Affine/IR/AffineOps.h"
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200   19) #include "mlir/Dialect/Affine/Utils.h"
3fcbe278712 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Lei Zhang          2022-09-30 15:04:13 -0400   20) #include "mlir/Dialect/Arith/Utils/Utils.h"
be3988dac62 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-11-17 05:26:39 +0800   21) #include "mlir/Dialect/Linalg/Utils/Utils.h"
362fd520cf8 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-13 16:36:28 -0700   22) #include "mlir/Dialect/MemRef/IR/MemRef.h"
362fd520cf8 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-13 16:36:28 -0700   23) #include "mlir/Dialect/Tensor/IR/Tensor.h"
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400   24) #include "mlir/Dialect/Utils/StaticValueUtils.h"
362fd520cf8 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-13 16:36:28 -0700   25) #include "mlir/Dialect/Utils/StructuredOpsUtils.h"
a6a56a97ae0 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-05-28 12:35:45 -0700   26) #include "mlir/IR/AffineExpr.h"
a6a56a97ae0 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-05-28 12:35:45 -0700   27) #include "mlir/IR/AffineMap.h"
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   28) #include "mlir/IR/Attributes.h"
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   29) #include "mlir/IR/Builders.h"
a6a56a97ae0 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-05-28 12:35:45 -0700   30) #include "mlir/IR/BuiltinAttributes.h"
2976a9bda68 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-25 15:33:37 -0700   31) #include "mlir/IR/BuiltinTypeInterfaces.h"
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   32) #include "mlir/IR/Diagnostics.h"
2976a9bda68 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-25 15:33:37 -0700   33) #include "mlir/IR/OpDefinition.h"
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   34) #include "mlir/IR/OperationSupport.h"
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   35) #include "mlir/IR/TypeUtilities.h"
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   36) #include "mlir/IR/Value.h"
a6a56a97ae0 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-05-28 12:35:45 -0700   37) #include "mlir/IR/ValueRange.h"
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400   38) #include "mlir/Interfaces/InferTypeOpInterface.h"
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   39) #include "mlir/Support/LLVM.h"
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   40) #include "mlir/Support/LogicalResult.h"
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   41) 
a6a56a97ae0 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-05-28 12:35:45 -0700   42) #include <cstdint>
a6a56a97ae0 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-05-28 12:35:45 -0700   43) #include <optional>
a6a56a97ae0 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-05-28 12:35:45 -0700   44) 
fdfe344a8b7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-04-17 10:08:53 -0700   45) namespace mlir::iree_compiler::IREE::LinalgExt {
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   46) 
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   47) //===----------------------------------------------------------------------===//
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   48) // Utils.
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   49) //===----------------------------------------------------------------------===//
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   50) 
862f4145143 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2023-04-12 17:18:10 -0400   51) static Type getComplexElementTypeOrSelf(Type ty) {
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800   52)   if (auto complex = dyn_cast_or_null<ComplexType>(ty)) {
862f4145143 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2023-04-12 17:18:10 -0400   53)     return complex.getElementType();
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800   54)   }
862f4145143 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2023-04-12 17:18:10 -0400   55)   return ty;
862f4145143 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2023-04-12 17:18:10 -0400   56) }
862f4145143 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2023-04-12 17:18:10 -0400   57) 
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   58) static void getEffectsImpl(
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   59)     SmallVectorImpl<SideEffects::EffectInstance<MemoryEffects::Effect>>
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   60)         &effects,
d2bca4efb48 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-07-02 00:40:44 -0400   61)     ArrayRef<OpOperand *> inputOperands, MutableOperandRange outputOperands) {
d2bca4efb48 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-07-02 00:40:44 -0400   62)   for (OpOperand *operand : inputOperands) {
d2bca4efb48 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-07-02 00:40:44 -0400   63)     if (!llvm::isa<MemRefType>(operand->get().getType())) {
de51b222886 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2023-09-25 17:25:02 -0700   64)       continue;
de51b222886 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2023-09-25 17:25:02 -0700   65)     }
d2bca4efb48 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-07-02 00:40:44 -0400   66)     effects.emplace_back(MemoryEffects::Read::get(), operand,
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   67)                          SideEffects::DefaultResource::get());
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   68)   }
d2bca4efb48 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-07-02 00:40:44 -0400   69)   for (OpOperand &operand : outputOperands) {
d2bca4efb48 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-07-02 00:40:44 -0400   70)     if (!llvm::isa<MemRefType>(operand.get().getType())) {
de51b222886 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2023-09-25 17:25:02 -0700   71)       continue;
de51b222886 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2023-09-25 17:25:02 -0700   72)     }
d2bca4efb48 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-07-02 00:40:44 -0400   73)     effects.emplace_back(MemoryEffects::Read::get(), &operand,
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   74)                          SideEffects::DefaultResource::get());
d2bca4efb48 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-07-02 00:40:44 -0400   75)     effects.emplace_back(MemoryEffects::Write::get(), &operand,
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   76)                          SideEffects::DefaultResource::get());
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   77)   }
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   78) }
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800   79) 
c82cf5d28bd llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2022-11-03 13:51:15 -0700   80) /// Return true if `dimsPos` is invalid. It is invalid when: a) it contains
c82cf5d28bd llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2022-11-03 13:51:15 -0700   81) /// duplicate. b) At least one dimension is out of bound (`dimPos` is >= 0 and <
c82cf5d28bd llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2022-11-03 13:51:15 -0700   82) /// rank). c) the number of elements in `dimsPos` is > than `rank`.
c82cf5d28bd llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2022-11-03 13:51:15 -0700   83) static bool isInvalid(ArrayRef<int64_t> dimsPos, int64_t rank) {
c82cf5d28bd llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2022-11-03 13:51:15 -0700   84)   // early exit.
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800   85)   if (dimsPos.size() > rank) {
c82cf5d28bd llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2022-11-03 13:51:15 -0700   86)     return true;
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800   87)   }
c82cf5d28bd llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2022-11-03 13:51:15 -0700   88)   DenseSet<int64_t> uniqued;
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800   89)   for (int64_t dim : dimsPos) {
c82cf5d28bd llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2022-11-03 13:51:15 -0700   90)     uniqued.insert(dim);
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800   91)   }
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800   92)   if (dimsPos.size() != uniqued.size()) {
c82cf5d28bd llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2022-11-03 13:51:15 -0700   93)     return true;
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800   94)   }
c82cf5d28bd llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2022-11-03 13:51:15 -0700   95)   return llvm::any_of(
c82cf5d28bd llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2022-11-03 13:51:15 -0700   96)       dimsPos, [rank](int64_t dimPos) { return dimPos < 0 || dimPos >= rank; });
c82cf5d28bd llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2022-11-03 13:51:15 -0700   97) }
c82cf5d28bd llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2022-11-03 13:51:15 -0700   98) 
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800   99) /// Emit an error and return failure when `seq` is invalid. It is only valid
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  100) /// when it is a permutation of the sequence 0...length(seq) - 1.
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  101) static LogicalResult
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  102) isPermSequence(function_ref<InFlightDiagnostic()> emitError,
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  103)                ArrayRef<int64_t> seq) {
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  104)   BitVector seen(seq.size(), false);
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  105)   for (auto [idx, dim] : llvm::enumerate(seq)) {
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  106)     if (dim < 0 || dim >= seq.size()) {
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  107)       return emitError().attachNote() << "element (" << dim << ") at index#"
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  108)                                       << idx << " is out of bounds";
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  109)     }
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  110)     if (seen.test(dim)) {
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  111)       return emitError().attachNote()
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  112)              << "element (" << dim << ") at index#" << idx << " is a duplicate";
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  113)     }
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  114)     seen.set(dim);
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  115)   }
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  116)   return success();
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  117) }
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  118) 
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  119) /// Returns true if the dimension of `sourceShape` is smaller than the dimension
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  120) /// of the `limitShape`.
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  121) static bool isSmallerThan(ArrayRef<int64_t> sourceShape,
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  122)                           ArrayRef<int64_t> limitShape) {
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  123)   assert(
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  124)       sourceShape.size() == limitShape.size() &&
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  125)       "expected source shape rank, and limit of the shape to have same rank");
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  126)   return llvm::all_of(llvm::zip_equal(sourceShape, limitShape),
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  127)                       [](std::tuple<int64_t, int64_t> it) {
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  128)                         int64_t sourceExtent = std::get<0>(it);
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  129)                         int64_t limit = std::get<1>(it);
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  130)                         return ShapedType::isDynamic(sourceExtent) ||
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  131)                                ShapedType::isDynamic(limit) ||
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  132)                                sourceExtent <= limit;
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  133)                       });
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  134) }
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  135) 
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  136) /// Helper function to verify both `scatter` and `gather`. Since both ops share
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  137) /// the same sementics, we can use the same function to verify them. Note: this
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  138) /// is written from the perspective of `scatter` op. For gather, `updateType`
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  139) /// maps to the type of the output and `originalType` maps to the type of the
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  140) /// `source`.
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  141) template <typename OpTy>
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  142) static LogicalResult
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  143) verifyGatherScatter(OpTy op, int64_t sliceRank, ShapedType originalType,
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  144)                     ShapedType updateType, StringRef originalName,
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  145)                     StringRef updateName) {
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  146)   static_assert(llvm::is_one_of<OpTy, GatherOp, ScatterOp>::value,
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  147)                 "applies to only gather or scatter operations");
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  148)   if (op.getInputs().size() != 2) {
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  149)     return op.emitOpError("expected two input operands");
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  150)   }
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  151)   if (op.getOutputs().size() != 1) {
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  152)     return op.emitOpError("expected one output operand");
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  153)   }
41a2f61b0a0 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-09 06:22:17 +0800  154) 
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  155)   auto indicesType = op.getIndicesType();
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  156)   if (indicesType.getRank() < 1 ||
69ca7dfa042 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-09-09 11:27:46 -0700  157)       !isa<IntegerType>(indicesType.getElementType())) {
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  158)     return op->emitOpError("expected indices to be of rank 1 or greater and of "
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  159)                            "integer element type");
41a2f61b0a0 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-09 06:22:17 +0800  160)   }
41a2f61b0a0 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-09 06:22:17 +0800  161) 
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  162)   ArrayRef<int64_t> dimMap = op.getDimensionMap();
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  163)   if (failed(isPermSequence(
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  164)           [&]() { return op->emitOpError("dimension map is invalid."); },
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  165)           dimMap))) {
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  166)     return failure();
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  167)   }
c82cf5d28bd llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2022-11-03 13:51:15 -0700  168) 
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  169)   if (dimMap.size() == 0) {
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  170)     return op->emitOpError("dimension map must have at least one element");
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  171)   }
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  172) 
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  173)   const size_t indexDepth = op.getIndexDepth();
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  174)   const auto originalSliceRank = originalType.getRank() - indexDepth;
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  175)   if (originalSliceRank < 0) {
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  176)     return op->emitOpError("expected " + originalName +
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  177)                            " rank to be greater or equal to index depth");
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  178)   }
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  179)   if (updateType.getRank() < originalSliceRank) {
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  180)     return op->emitOpError("expected " + updateName +
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  181)                            " to be at least the rank of non indexed " +
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  182)                            originalName + " dims");
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  183)   }
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  184)   const size_t batchRank = updateType.getRank() - originalSliceRank;
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  185) 
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  186)   if (updateType.getRank() - batchRank != originalSliceRank) {
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  187)     return op->emitOpError("expected rank of " + updateName +
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  188)                            " value - batch rank to be "
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  189)                            "equal to rank of " +
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  190)                            originalName + " value - index depth");
91f179f24f2 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2022-02-16 15:47:49 -0800  191)   }
91f179f24f2 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2022-02-16 15:47:49 -0800  192) 
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  193)   if ((indicesType.getRank() != batchRank || indexDepth != 1) &&
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  194)       indicesType.getRank() != batchRank + 1) {
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  195)     return op->emitOpError("expected indices to be equal to batch rank "
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  196)                            "or batch rank + 1");
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  197)   }
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  198) 
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  199)   {
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  200)     // Validate the shape of indices and update value match for the first
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  201)     // `batchRank` dims.
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  202)     auto [indicesIt, updateIt] =
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  203)         llvm::mismatch(indicesType.getShape().take_front(batchRank),
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  204)                        updateType.getShape().take_front(batchRank));
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  205)     if (indicesIt != indicesType.getShape().take_front(batchRank).end()) {
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  206)       return op->emitOpError("mismatch in shape of indices and " + updateName +
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  207)                              " value at dim#")
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  208)              << (indicesIt - indicesType.getShape().begin());
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  209)     }
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  210)   }
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  211)   if (batchRank + 1 < indicesType.getShape().size() &&
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  212)       dimMap.size() != indicesType.getShape().back()) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  213)     return op->emitOpError(
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  214)         "size of dimension map must match the last dimension of indices");
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  215)   }
6b64fca85f7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-06 09:20:50 -0800  216) 
b47fbdf4254 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-21 10:41:07 -0800  217)   {
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  218)     for (auto idx : llvm::seq<int64_t>(0, sliceRank)) {
2cd88d580fe compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-22 14:56:47 -0800  219)       int64_t updateDim = idx + batchRank;
2cd88d580fe compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-22 14:56:47 -0800  220)       int64_t origDim = idx + indexDepth;
2cd88d580fe compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-22 14:56:47 -0800  221)       if (originalType.isDynamicDim(origDim) ||
2cd88d580fe compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-22 14:56:47 -0800  222)           updateType.isDynamicDim(updateDim)) {
2cd88d580fe compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-22 14:56:47 -0800  223)         continue;
2cd88d580fe compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-22 14:56:47 -0800  224)       }
2cd88d580fe compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-22 14:56:47 -0800  225)       if (originalType.getDimSize(origDim) !=
2cd88d580fe compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-22 14:56:47 -0800  226)           updateType.getDimSize(updateDim)) {
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  227)         return op->emitOpError("shape of " + updateName + " value dim#")
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  228)                << (updateDim)
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  229)                << " must match " + originalName + " value at dim#" << (origDim);
2cd88d580fe compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-01-22 14:56:47 -0800  230)       }
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  231)     }
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  232)   }
91f179f24f2 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2022-02-16 15:47:49 -0800  233) 
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  234)   Region &region = op.getRegion();
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  235)   Block *body = &region.front();
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  236)   if (body->getNumArguments() != 2) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  237)     return op->emitOpError("expected region to have two arguments");
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  238)   }
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  239)   Type arg0Type = body->getArgument(0).getType();
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  240)   Type arg1Type = body->getArgument(1).getType();
862f4145143 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2023-04-12 17:18:10 -0400  241)   if (!getComplexElementTypeOrSelf(arg0Type).isIntOrFloat() ||
862f4145143 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Rob Suderman       2023-04-12 17:18:10 -0400  242)       !getComplexElementTypeOrSelf(arg1Type).isIntOrFloat()) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  243)     return op->emitOpError(
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  244)         "expected region to have scalar argument of integer or float types");
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  245)   }
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  246)   if (arg0Type != updateType.getElementType()) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  247)     return op->emitOpError("mismatch in argument 0 of region ")
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  248)            << arg0Type << " and element type of " + updateName + " value "
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  249)            << updateType.getElementType();
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  250)   }
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  251)   if (arg1Type != originalType.getElementType()) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  252)     return op->emitOpError("mismatch in argument 1 of region ")
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  253)            << arg1Type << " and element type of " + originalName + " value "
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  254)            << originalType.getElementType();
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  255)   }
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  256)   if (arg0Type != arg1Type) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  257)     return op->emitOpError("mismatch in region argument types ")
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  258)            << arg0Type << " and " << arg1Type;
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  259)   }
02cfcd1e556 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2021-11-14 13:20:53 -0800  260)   auto yieldOp = cast<IREE::LinalgExt::YieldOp>(body->getTerminator());
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  261)   if (yieldOp->getNumOperands() != 1) {
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  262)     return yieldOp.emitOpError("expected region to yield a single value");
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  263)   }
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  264)   auto yieldedType = yieldOp->getOperand(0).getType();
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  265)   if (yieldedType != arg0Type) {
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  266)     return yieldOp.emitOpError("mismatch in type of yielded value ")
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  267)            << yieldedType << " and argument of the region " << arg0Type;
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  268)   }
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  269)   return success();
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  270) }
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  271) 
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  272) //===----------------------------------------------------------------------===//
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  273) // ScatterOp
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  274) //===----------------------------------------------------------------------===//
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  275) 
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  276) LogicalResult ScatterOp::verify() {
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  277)   return verifyGatherScatter(*this, getUpdateSliceRank(), getOriginalType(),
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  278)                              getUpdateType(), "original", "update");
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  279) }
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  280) 
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  281) LogicalResult
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  282) ScatterOp::reifyResultShapes(OpBuilder &b,
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  283)                              ReifiedRankedShapedTypeDims &reifiedReturnShapes) {
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  284)   return cast<LinalgExtOp>(getOperation())
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  285)       .reifyResultShapes(b, reifiedReturnShapes);
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  286) }
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  287) 
1e6bbb82368 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-14 13:25:49 +0100  288) FailureOr<SmallVector<int64_t>> ScatterOp::getStaticLoopRanges() {
1e6bbb82368 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-14 13:25:49 +0100  289)   // Scatter loop ranges are loop ranges for update.
1e6bbb82368 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-14 13:25:49 +0100  290)   return SmallVector<int64_t>(getUpdateType().getShape());
1e6bbb82368 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-14 13:25:49 +0100  291) }
1e6bbb82368 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-14 13:25:49 +0100  292) 
a6a56a97ae0 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-05-28 12:35:45 -0700  293) SmallVector<AffineMap> ScatterOp::getIndexingMapsForOperands() {
a6a56a97ae0 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-05-28 12:35:45 -0700  294)   Builder builder(getContext());
a6a56a97ae0 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-05-28 12:35:45 -0700  295)   return {builder.getMultiDimIdentityMap(getUpdateType().getRank()),
d01fb2341c1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-06-20 09:49:57 -0700  296)           builder.getMultiDimIdentityMap(getIndicesType().getRank()),
d01fb2341c1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-06-20 09:49:57 -0700  297)           /*output=*/AffineMap(nullptr)};
a6a56a97ae0 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-05-28 12:35:45 -0700  298) }
a6a56a97ae0 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-05-28 12:35:45 -0700  299) 
a6a56a97ae0 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-05-28 12:35:45 -0700  300) SmallVector<AffineMap> ScatterOp::getIndexingMapsForResults() {
a6a56a97ae0 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-05-28 12:35:45 -0700  301)   return {AffineMap(nullptr)};
a6a56a97ae0 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-05-28 12:35:45 -0700  302) }
a6a56a97ae0 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-05-28 12:35:45 -0700  303) 
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  304) //===----------------------------------------------------------------------===//
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  305) // GatherOp
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  306) //===----------------------------------------------------------------------===//
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  307) 
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  308) LogicalResult GatherOp::verify() {
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  309)   return verifyGatherScatter(*this, getOutputSliceRank(), getSourceType(),
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  310)                              getOutputType(), "source", "output");
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  311) }
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  312) 
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  313) LogicalResult
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  314) GatherOp::reifyResultShapes(OpBuilder &b,
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  315)                             ReifiedRankedShapedTypeDims &reifiedReturnShapes) {
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  316)   return cast<LinalgExtOp>(getOperation())
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  317)       .reifyResultShapes(b, reifiedReturnShapes);
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  318) }
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700  319) 
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  320) //===----------------------------------------------------------------------===//
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  321) // MapScatterOp
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  322) //===----------------------------------------------------------------------===//
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  323) 
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  324) LogicalResult MapScatterOp::verify() {
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  325)   if (getInputType().getElementType() != getOutputType().getElementType()) {
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  326)     return emitOpError("expected input and output element types to match");
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  327)   }
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  328)   Region &transformRegion = getTransformationRegion();
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  329)   Block &transformBody = transformRegion.getBlocks().front();
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  330)   if (transformBody.getNumArguments() != getInputRank()) {
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  331)     return emitOpError("expected number of block arguments to be equal "
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  332)                        "to the input rank");
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  333)   }
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  334)   if (!llvm::all_of(transformBody.getArgumentTypes(),
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  335)                     llvm::IsaPred<IndexType>)) {
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  336)     return emitOpError("expected block arguments to be index types");
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  337)   }
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  338)   auto yieldOp = cast<IREE::LinalgExt::YieldOp>(transformBody.getTerminator());
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  339)   if (yieldOp->getNumOperands() != getOutputRank() + 1) {
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  340)     return yieldOp.emitOpError("expected transformation_region to yield a "
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  341)                                "value for each output dimension and a mask");
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  342)   }
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  343)   for (int operandIdx = 0; operandIdx < getOutputRank(); ++operandIdx) {
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  344)     if (!isa<IndexType>(yieldOp.getOperandTypes()[operandIdx])) {
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  345)       return yieldOp.emitOpError("expected yielded indices to be index types");
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  346)     }
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  347)   }
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  348)   auto maskType =
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  349)       dyn_cast<IntegerType>(yieldOp.getOperandTypes()[getOutputRank()]);
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  350)   if (!maskType || maskType.getIntOrFloatBitWidth() != 1) {
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  351)     return yieldOp.emitOpError("expected yielded mask to be i1 type");
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  352)   }
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  353)   return success();
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  354) }
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400  355) 
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  356) //===----------------------------------------------------------------------===//
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  357) // SortOp
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  358) //===----------------------------------------------------------------------===//
be17032646c iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-02 14:08:15 -0700  359) 
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  360) LogicalResult SortOp::verify() {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  361)   Operation *op = getOperation();
de51b222886 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2023-09-25 17:25:02 -0700  362)   if (getNumDpsInputs()) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  363)     return op->emitOpError("does not expect to take any inputs");
f8b13d84cab iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 09:33:47 +0800  364)   }
de51b222886 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2023-09-25 17:25:02 -0700  365)   if (getNumDpsInits() == 0) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  366)     return op->emitOpError("expected at least one `outs` operand");
362fd520cf8 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-13 16:36:28 -0700  367)   }
f8b13d84cab iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 09:33:47 +0800  368) 
d750badfdf0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-09-08 08:44:34 +0800  369)   Block &block = getRegion().front();
de51b222886 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2023-09-25 17:25:02 -0700  370)   size_t numOutputs = getNumDpsInits();
f8b13d84cab iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 09:33:47 +0800  371)   if (block.getNumArguments() != 2 * numOutputs) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  372)     return op->emitOpError("region block should have ")
f8b13d84cab iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 09:33:47 +0800  373)            << 2 * numOutputs << " arguments";
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  374)   }
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  375) 
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  376)   int64_t rank = getOperandRank();
d750badfdf0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-09-08 08:44:34 +0800  377)   int sortDim = getDimension();
a2df20325c4 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-02-21 14:53:02 -0800  378)   if (sortDim < 0 || sortDim >= rank) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  379)     return op->emitOpError("dimension must be within (0, ") << rank << "]";
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  380)   }
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  381) 
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  382)   ArrayRef<int64_t> shape = getOperandShape();
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  383)   for (auto [index, operand] : llvm::enumerate(getOutputs())) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  384)     auto operandType = getOperandType(index);
362fd520cf8 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-13 16:36:28 -0700  385)     if (operandType.getRank() != rank) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  386)       return op->emitOpError("expected operand ")
362fd520cf8 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-13 16:36:28 -0700  387)              << index << " to be rank " << rank << ", same as other operands";
362fd520cf8 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-13 16:36:28 -0700  388)     }
362fd520cf8 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-13 16:36:28 -0700  389)     if (operandType.getShape() != shape) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  390)       return op->emitOpError("expected operand ")
362fd520cf8 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-13 16:36:28 -0700  391)              << index << " to have same shape as other operands";
362fd520cf8 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-13 16:36:28 -0700  392)     }
362fd520cf8 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (MaheshRavishankar  2021-07-13 16:36:28 -0700  393)     Type elemType = operandType.getElementType();
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  394)     for (int i : {2 * index, 2 * index + 1}) {
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  395)       Type argType = block.getArgument(i).getType();
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  396)       if (argType != elemType) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  397)         return op->emitOpError("region block argument #")
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  398)                << i << " should be of type " << elemType << " but got "
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  399)                << argType;
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  400)       }
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  401)     }
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  402)   }
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  403) 
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  404)   auto yieldOp = cast<YieldOp>(block.getTerminator());
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  405)   if (yieldOp.getNumOperands() != 1) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  406)     return op->emitOpError("should yield exactly one operand");
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  407)   }
714bf6073d5 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Jorn Tuyls         2024-04-25 23:59:41 +0200  408)   auto ty = dyn_cast<IntegerType>(yieldOp.getOperand(0).getType());
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  409)   if (!ty || ty.getWidth() != 1) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  410)     return op->emitOpError("should yield i1 type");
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  411)   }
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  412) 
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  413)   return success();
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  414) }
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800  415) 
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  416) LogicalResult
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  417) SortOp::reifyResultShapes(OpBuilder &b,
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  418)                           ReifiedRankedShapedTypeDims &reifiedReturnShapes) {
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  419)   return cast<LinalgExtOp>(getOperation())
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  420)       .reifyResultShapes(b, reifiedReturnShapes);
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  421) }
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  422) 
71e709fb7c6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-30 10:46:44 +0800  423) //===----------------------------------------------------------------------===//
71e709fb7c6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-30 10:46:44 +0800  424) // FftOp
71e709fb7c6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-30 10:46:44 +0800  425) //===----------------------------------------------------------------------===//
71e709fb7c6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-30 10:46:44 +0800  426) 
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  427) LogicalResult FftOp::verify() {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  428)   Operation *op = getOperation();
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  429)   auto length = getFftLength();
b7a5333b299 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-09-17 08:42:25 +0800  430)   // After tiling, it could be dynamic shape. (Because
b7a5333b299 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-09-17 08:42:25 +0800  431)   // subview/subtensor does not inference the type correctly
b7a5333b299 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-09-17 08:42:25 +0800  432)   // on (1 << x)) cases).
ef35fa2dc8f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2023-12-07 16:43:04 -0800  433)   if (ShapedType::isDynamic(length))
11fb8d0c1c3 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Nicolas Vasilache  2022-03-21 20:33:30 +0100  434)     return success();
71e709fb7c6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-30 10:46:44 +0800  435)   if (length & (length - 1)) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  436)     return op->emitOpError("only powers of 2 are handled currently");
71e709fb7c6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-30 10:46:44 +0800  437)   }
de51b222886 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2023-09-25 17:25:02 -0700  438)   if (!getNumDpsInputs() || !isScalar(getDpsInputOperand(0))) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  439)     return op->emitOpError("expected to carry `stage` input");
71e709fb7c6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-30 10:46:44 +0800  440)   }
de51b222886 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2023-09-25 17:25:02 -0700  441)   if (getNumDpsInputs() != 1) {
de51b222886 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2023-09-25 17:25:02 -0700  442)     if (getNumDpsInputs() != 3 || isScalar(getDpsInputOperand(1)) ||
de51b222886 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2023-09-25 17:25:02 -0700  443)         isScalar(getDpsInputOperand(2))) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  444)       return op->emitOpError("expected to carry real and imag coeff inputs");
3c7bd066185 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-08-05 03:16:41 +0800  445)     }
3c7bd066185 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-08-05 03:16:41 +0800  446)   }
de51b222886 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2023-09-25 17:25:02 -0700  447)   if (getNumDpsInits() != 2) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  448)     return op->emitOpError(
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  449)         "expected outputs to be real and imag tensor/memref");
71e709fb7c6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-30 10:46:44 +0800  450)   }
71e709fb7c6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-30 10:46:44 +0800  451)   return success();
71e709fb7c6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-30 10:46:44 +0800  452) }
71e709fb7c6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-30 10:46:44 +0800  453) 
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  454) LogicalResult
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  455) FftOp::reifyResultShapes(OpBuilder &b,
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  456)                          ReifiedRankedShapedTypeDims &reifiedReturnShapes) {
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  457)   return cast<LinalgExtOp>(getOperation())
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  458)       .reifyResultShapes(b, reifiedReturnShapes);
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  459) }
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  460) 
e6ea095c84f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-10 17:44:25 -0800  461) //===----------------------------------------------------------------------===//
e6ea095c84f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-10 17:44:25 -0800  462) // ScanOp
e6ea095c84f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-10 17:44:25 -0800  463) //===----------------------------------------------------------------------===//
e6ea095c84f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-10 17:44:25 -0800  464) 
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  465) LogicalResult ScanOp::verify() {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  466)   Operation *op = getOperation();
de51b222886 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2023-09-25 17:25:02 -0700  467)   if (getNumDpsInputs() != 1) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  468)     return op->emitOpError("expected one input operands");
e6ea095c84f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-10 17:44:25 -0800  469)   }
de51b222886 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2023-09-25 17:25:02 -0700  470)   if (getNumDpsInits() != 2) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  471)     return op->emitOpError("expected two output operands");
e6ea095c84f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-10 17:44:25 -0800  472)   }
c81496c512d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-05-10 07:16:50 -0700  473)   if (!isa<ShapedType>(getInput().getType())) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  474)     return op->emitOpError("expected first input element type to be shaped");
2e9223125a1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-11 10:49:49 -0800  475)   }
c81496c512d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-05-10 07:16:50 -0700  476)   auto accumulatorType = cast<ShapedType>(getAccumulator().getType());
c81496c512d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-05-10 07:16:50 -0700  477)   auto inputType = cast<ShapedType>(getInput().getType());
c81496c512d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-05-10 07:16:50 -0700  478)   auto outputType = cast<ShapedType>(getOutput().getType());
7dd67198fc6 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-20 16:44:03 -0800  479)   ArrayRef<int64_t> inputShapes = inputType.getShape();
7dd67198fc6 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-20 16:44:03 -0800  480)   ArrayRef<int64_t> outputShapes = outputType.getShape();
7dd67198fc6 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-20 16:44:03 -0800  481)   if (accumulatorType.getElementType() != inputType.getElementType()) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  482)     return op->emitOpError(
7dd67198fc6 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-20 16:44:03 -0800  483)         "expected input/accumulator element types to be identical");
7dd67198fc6 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-20 16:44:03 -0800  484)   }
7dd67198fc6 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-20 16:44:03 -0800  485)   ArrayRef<int64_t> accumulatorShape = accumulatorType.getShape();
7dd67198fc6 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-20 16:44:03 -0800  486)   int64_t accumulatorRank = accumulatorType.getRank();
7dd67198fc6 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-20 16:44:03 -0800  487)   if (accumulatorRank != inputType.getRank() - 1) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  488)     return op->emitOpError(
7dd67198fc6 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-20 16:44:03 -0800  489)         "expected accumulator rank to be equal to input rank - 1");
7dd67198fc6 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-20 16:44:03 -0800  490)   }
7dd67198fc6 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-20 16:44:03 -0800  491)   SmallVector<int64_t> expectedAccumulatorShape;
7dd67198fc6 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-20 16:44:03 -0800  492)   for (int i = 0; i < inputType.getRank(); i++) {
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  493)     if (i != getDimension()) {
11fb8d0c1c3 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Nicolas Vasilache  2022-03-21 20:33:30 +0100  494)       expectedAccumulatorShape.push_back(inputShapes[i]);
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  495)     }
7dd67198fc6 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-20 16:44:03 -0800  496)   }
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  497)   if (llvm::any_of(llvm::zip_equal(expectedAccumulatorShape, accumulatorShape),
7dd67198fc6 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-20 16:44:03 -0800  498)                    [](std::tuple<int64_t, int64_t> s) {
ef35fa2dc8f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2023-12-07 16:43:04 -0800  499)                      return !ShapedType::isDynamic(std::get<0>(s)) &&
ef35fa2dc8f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2023-12-07 16:43:04 -0800  500)                             !ShapedType::isDynamic(std::get<1>(s)) &&
7dd67198fc6 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-20 16:44:03 -0800  501)                             std::get<0>(s) != std::get<1>(s);
7dd67198fc6 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-20 16:44:03 -0800  502)                    })) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  503)     return op->emitOpError("incompatible input/accumulator shapes");
e6ea095c84f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-10 17:44:25 -0800  504)   }
e6ea095c84f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-10 17:44:25 -0800  505)   if (inputType.getElementType() != outputType.getElementType()) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  506)     return op->emitOpError(
e6ea095c84f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-10 17:44:25 -0800  507)         "expected input/output element types to be identical");
e6ea095c84f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-10 17:44:25 -0800  508)   }
e6ea095c84f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-10 17:44:25 -0800  509)   if (inputShapes.size() != outputShapes.size()) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  510)     return op->emitOpError("expected input/output to have identical ranks");
e6ea095c84f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-10 17:44:25 -0800  511)   }
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  512)   if (llvm::any_of(llvm::zip_equal(inputShapes, outputShapes),
e6ea095c84f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-10 17:44:25 -0800  513)                    [](std::tuple<int64_t, int64_t> s) {
ef35fa2dc8f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2023-12-07 16:43:04 -0800  514)                      return !ShapedType::isDynamic(std::get<0>(s)) &&
ef35fa2dc8f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2023-12-07 16:43:04 -0800  515)                             !ShapedType::isDynamic(std::get<1>(s)) &&
e6ea095c84f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-10 17:44:25 -0800  516)                             std::get<0>(s) != std::get<1>(s);
e6ea095c84f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-10 17:44:25 -0800  517)                    })) {
f488f177f9e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-03-18 18:19:02 -0700  518)     return op->emitOpError("incompatible input/output shapes");
e6ea095c84f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-10 17:44:25 -0800  519)   }
e6ea095c84f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-10 17:44:25 -0800  520)   return success();
e6ea095c84f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-10 17:44:25 -0800  521) }
e6ea095c84f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-10 17:44:25 -0800  522) 
a61c0e2a3ad llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2023-01-31 13:40:37 -0800  523) LogicalResult ScanOp::fold(FoldAdaptor, SmallVectorImpl<OpFoldResult> &) {
fcb9e4e8e0a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-10-25 02:43:45 +0800  524)   return memref::foldMemRefCast(*this);
7dd67198fc6 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-20 16:44:03 -0800  525) }
7dd67198fc6 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-20 16:44:03 -0800  526) 
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  527) LogicalResult
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  528) ScanOp::reifyResultShapes(OpBuilder &b,
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  529)                           ReifiedRankedShapedTypeDims &reifiedReturnShapes) {
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  530)   return cast<LinalgExtOp>(getOperation())
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  531)       .reifyResultShapes(b, reifiedReturnShapes);
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  532) }
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  533) 
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  534) //===----------------------------------------------------------------------===//
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  535) // TopkOp
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  536) //===----------------------------------------------------------------------===//
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  537) 
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  538) LogicalResult TopkOp::verify() {
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  539)   Operation *op = getOperation();
de51b222886 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2023-09-25 17:25:02 -0700  540)   if (getNumDpsInputs() != 1 && getNumDpsInputs() != 2) {
2e4f780cddb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-05-27 13:03:26 -0400  541)     return op->emitOpError("expected one or two input operands");
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  542)   }
de51b222886 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2023-09-25 17:25:02 -0700  543)   if (getNumDpsInits() != 2) {
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  544)     return op->emitOpError("expected two output operands");
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  545)   }
d750badfdf0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-09-08 08:44:34 +0800  546)   if (getDimension() >= getInputRank()) {
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  547)     return op->emitOpError("dimension exceeds rank");
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  548)   }
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  549)   // Ensure input/output element types match
c81496c512d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-05-10 07:16:50 -0700  550)   auto inputValuesType = cast<ShapedType>(getValues().getType());
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400  551)   auto outputValuesType = cast<ShapedType>(outputValues().getType());
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  552)   if (inputValuesType.getElementType() != outputValuesType.getElementType()) {
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  553)     return op->emitOpError("expected input/output value types to be identical");
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  554)   }
2e4f780cddb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-05-27 13:03:26 -0400  555)   // Indices must be int if provided
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400  556)   auto outputIndicesType = cast<ShapedType>(outputIndices().getType());
c81496c512d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-05-10 07:16:50 -0700  557)   if (auto inputIndices = getIndices()) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400  558)     auto inputIndicesType = cast<ShapedType>(inputIndices->getType());
2e4f780cddb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-05-27 13:03:26 -0400  559)     if (!inputIndicesType.getElementType().isInteger(32) ||
2e4f780cddb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-05-27 13:03:26 -0400  560)         !outputIndicesType.getElementType().isInteger(32)) {
2e4f780cddb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-05-27 13:03:26 -0400  561)       return op->emitOpError("expected input/output indices types to be int32");
2e4f780cddb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-05-27 13:03:26 -0400  562)     }
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  563)   }
2e4f780cddb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-05-27 13:03:26 -0400  564) 
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  565)   // Ranks must match
2e4f780cddb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-05-27 13:03:26 -0400  566)   if (inputValuesType.getRank() != outputValuesType.getRank()) {
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  567)     return op->emitOpError("expected input/output to have the same rank");
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  568)   }
c81496c512d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-05-10 07:16:50 -0700  569)   if (auto inputIndices = getIndices()) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400  570)     auto inputIndicesType = cast<ShapedType>(inputIndices->getType());
2e4f780cddb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-05-27 13:03:26 -0400  571)     if (inputIndicesType.getRank() != outputIndicesType.getRank()) {
2e4f780cddb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-05-27 13:03:26 -0400  572)       return op->emitOpError("expected input/output to have the same rank");
2e4f780cddb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-05-27 13:03:26 -0400  573)     }
2e4f780cddb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-05-27 13:03:26 -0400  574)   }
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  575)   // Input indicies and values must have the same shape.
c81496c512d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-05-10 07:16:50 -0700  576)   if (auto inputIndices = getIndices()) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400  577)     auto inputIndicesType = cast<ShapedType>(inputIndices->getType());
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  578)     if (failed(verifyCompatibleShape(inputValuesType, inputIndicesType))) {
2e4f780cddb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-05-27 13:03:26 -0400  579)       return op->emitOpError("input indices/values shape must match");
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  580)     }
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  581)   }
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  582)   // Output indicies and values must have the same shape.
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  583)   if (failed(verifyCompatibleShape(outputValuesType, outputIndicesType))) {
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  584)     return op->emitOpError("output indices/values shape must match");
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  585)   }
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  586)   // Input shape must match the output shape except for the dimension()
d750badfdf0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-09-08 08:44:34 +0800  587)   uint64_t dim = getDimension();
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  588)   if (!llvm::all_of(
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  589)           llvm::enumerate(llvm::zip_equal(inputValuesType.getShape(),
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  590)                                           outputValuesType.getShape())),
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  591)           [dim](auto e) {
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  592)             if (e.index() == dim) {
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  593)               return true;
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  594)             }
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  595)             std::tuple<int64_t, int64_t> s = e.value();
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  596)             return succeeded(
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  597)                 verifyCompatibleShape(std::get<0>(s), std::get<1>(s)));
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  598)           })) {
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  599)     return op->emitOpError("incompatible input/output shapes");
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  600)   }
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  601)   // Check region compatibility
d750badfdf0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-09-08 08:44:34 +0800  602)   Block &block = getRegion().front();
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  603)   if (block.getNumArguments() != 2) {
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  604)     return op->emitOpError("region block should have 2 arguments");
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  605)   }
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  606)   if (block.getArgument(0).getType() != inputValuesType.getElementType() ||
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  607)       block.getArgument(1).getType() != inputValuesType.getElementType()) {
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  608)     return op->emitOpError("region block types must match input");
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  609)   }
905de35f383 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-05-31 12:54:49 -0400  610)   auto terminatorOp = llvm::dyn_cast<YieldOp>(block.getTerminator());
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  611)   if (!terminatorOp || !terminatorOp.getOperand(0).getType().isInteger(1)) {
905de35f383 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-05-31 12:54:49 -0400  612)     return op->emitOpError("region block must end with a linalg_ext.yield i1!");
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  613)   }
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  614)   return success();
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  615) }
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700  616) 
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  617) LogicalResult
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  618) TopkOp::reifyResultShapes(OpBuilder &b,
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  619)                           ReifiedRankedShapedTypeDims &reifiedReturnShapes) {
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  620)   return cast<LinalgExtOp>(getOperation())
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  621)       .reifyResultShapes(b, reifiedReturnShapes);
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  622) }
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  623) 
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  624) //===----------------------------------------------------------------------===//
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  625) // PackOp and UnPackOp utils
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  626) //===----------------------------------------------------------------------===//
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  627) 
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  628) /// Return true if at least one element in `tiles` is zero.
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  629) static bool hasZeros(ArrayRef<OpFoldResult> tiles) {
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  630)   return llvm::any_of(
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  631)       tiles, [&](OpFoldResult tile) { return isConstantIntValue(tile, 0); });
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  632) }
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  633) 
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  634) /// Check if we have enough static information to catch undefined behavior when
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  635) /// the tile size does not divide perfectly the dimension of the input tensor.
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  636) static bool
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  637) areNotFullTiles(ArrayRef<int64_t> inputShape,
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  638)                 DenseMap<int64_t, OpFoldResult> const &dimAndTileMapping) {
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  639)   int64_t rank = inputShape.size();
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  640)   for (int64_t dim = 0; dim < rank; dim++) {
ef35fa2dc8f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2023-12-07 16:43:04 -0800  641)     if (ShapedType::isDynamic(inputShape[dim]))
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  642)       continue;
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  643)     auto it = dimAndTileMapping.find(dim);
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  644)     if (it != dimAndTileMapping.end()) {
6109e0c39f8 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Jacques Pienaar    2023-03-23 10:07:20 -0700  645)       std::optional<int64_t> constantTile = getConstantIntValue(it->second);
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  646)       if (!constantTile)
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  647)         continue;
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  648)       if (inputShape[dim] % (*constantTile) != 0)
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  649)         return true;
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  650)     }
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  651)   }
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  652)   return false;
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  653) }
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  654) 
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400  655) static SmallVector<OpFoldResult> getMixedValues(MLIRContext *context,
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400  656)                                                 ArrayRef<int64_t> staticValues,
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400  657)                                                 OperandRange dynamicValues) {
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400  658)   OpBuilder b(context);
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400  659)   return mlir::getMixedValues(staticValues, dynamicValues, b);
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400  660) }
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400  661) 
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400  662) static SmallVector<int64_t>
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400  663) getStaticValues(SmallVector<OpFoldResult> mixedValues) {
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400  664)   SmallVector<Value> dynamicTiles;
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400  665)   SmallVector<int64_t> staticTiles;
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400  666)   dispatchIndexOpFoldResults(mixedValues, dynamicTiles, staticTiles);
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400  667)   return staticTiles;
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400  668) }
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400  669) 
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  670) /// Utility function shared between Pack and UnPack to get the tile sizes as
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  671) /// OpFoldResults.
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  672) // TODO: interface or base class in .td
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  673) template <typename OpTy>
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  674) static SmallVector<OpFoldResult> getMixedTiles(OpTy op) {
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  675)   static_assert(llvm::is_one_of<OpTy, PackOp, UnPackOp>::value,
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  676)                 "applies to only pack or unpack operations");
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400  677)   return LinalgExt::getMixedValues(op.getContext(), op.getStaticInnerTiles(),
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400  678)                                    op.getInnerTiles());
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  679) }
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  680) 
4d3cb377574 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-10-07 07:16:07 +0800  681) /// Return the tile sizes as `int64_t`. If a tile size is dynamic a sentinel
d93c2634cb0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-11-22 04:07:22 -0500  682) /// `kDynamic` is introduced at that position in the returned vector.
4d3cb377574 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-10-07 07:16:07 +0800  683) template <typename OpTy>
4d3cb377574 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-10-07 07:16:07 +0800  684) static SmallVector<int64_t> getStaticTiles(OpTy op) {
4d3cb377574 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-10-07 07:16:07 +0800  685)   static_assert(llvm::is_one_of<OpTy, PackOp, UnPackOp>::value,
4d3cb377574 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-10-07 07:16:07 +0800  686)                 "applies to only pack or unpack operations");
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400  687)   return getStaticValues(op.getMixedTiles());
4d3cb377574 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-10-07 07:16:07 +0800  688) }
4d3cb377574 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-10-07 07:16:07 +0800  689) 
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  690) /// Utility function shared between Pack and UnPack to get a map between
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  691) /// `dim_pos` and `inner_tiles`.
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  692) // TODO: interface or base class in .td
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  693) template <typename OpTy>
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  694) static DenseMap<int64_t, OpFoldResult> getDimAndTileMapping(OpTy op) {
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  695)   static_assert(llvm::is_one_of<OpTy, PackOp, UnPackOp>::value,
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  696)                 "applies to only pack or unpack operations");
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  697)   DenseMap<int64_t, OpFoldResult> dimAndTileMapping;
b576330ffbb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Thomas             2022-11-29 22:21:35 -0800  698)   ArrayRef<int64_t> dimsToBlock = op.getInnerDimsPos();
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  699)   SmallVector<OpFoldResult> tiles = op.getMixedTiles();
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  700)   assert(tiles.size() == dimsToBlock.size() &&
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  701)          "tiles must match indices of dimension to block");
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  702)   // bind the dimension with the tile factor.
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  703)   for (auto i : llvm::seq<int64_t>(0, dimsToBlock.size())) {
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  704)     dimAndTileMapping[dimsToBlock[i]] = tiles[i];
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  705)   }
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  706)   return dimAndTileMapping;
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  707) }
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  708) 
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  709) /// Common verifier for `PackOp` and `UnPackOp`.
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  710) template <typename OpTy>
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  711) static LogicalResult commonVerifierPackAndUnPackOp(OpTy packOrUnPack) {
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  712)   static_assert(llvm::is_one_of<OpTy, PackOp, UnPackOp>::value,
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  713)                 "applies to only pack or unpack operations");
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  714)   Operation *op = packOrUnPack.getOperation();
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  715)   ShapedType unpackedType = (std::is_same<OpTy, PackOp>::value)
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  716)                                 ? packOrUnPack.getInputType()
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  717)                                 : packOrUnPack.getOutputType();
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  718)   int64_t unpackedRank = unpackedType.getRank();
b576330ffbb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Thomas             2022-11-29 22:21:35 -0800  719)   ArrayRef<int64_t> innerDimsPos = packOrUnPack.getInnerDimsPos();
b576330ffbb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Thomas             2022-11-29 22:21:35 -0800  720)   ArrayRef<int64_t> outerDimPerm = packOrUnPack.getOuterDimsPerm();
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  721)   // Verify tiles. Make sure each provided tile is non-zero.
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  722)   SmallVector<OpFoldResult> mixedTiles = packOrUnPack.getMixedTiles();
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  723)   if (hasZeros(mixedTiles)) {
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  724)     return op->emitError("invalid tile factor");
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  725)   }
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  726)   if (isInvalid(innerDimsPos, unpackedRank)) {
20ef4097688 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-07 23:51:50 +0200  727)     return op->emitError("invalid inner_dims_pos vector");
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  728)   }
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  729)   if (isInvalid(outerDimPerm, unpackedRank)) {
20ef4097688 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-07 23:51:50 +0200  730)     return op->emitError("invalid outer_dims_perm vector");
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  731)   }
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  732)   if (mixedTiles.size() != innerDimsPos.size()) {
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  733)     return op->emitError(
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  734)         "blocking factors must equal the number of dimensions to block");
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  735)   }
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  736) 
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  737)   // Blocking factors must be less or equal than the input rank, and must
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  738)   // match the number of `dims_pos`.
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  739)   if (mixedTiles.size() > unpackedRank) {
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  740)     return op->emitError(
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  741)         "blocking factors must be less or equal than the input rank");
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  742)   }
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  743) 
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  744)   ShapedType packedType = (std::is_same<OpTy, PackOp>::value)
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  745)                               ? packOrUnPack.getOutputType()
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  746)                               : packOrUnPack.getInputType();
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  747)   int64_t packedRank = packedType.getRank();
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  748)   // Require output rank to match input rank + number of blocking factors.
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  749)   if (unpackedRank + mixedTiles.size() != packedRank) {
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  750)     return op->emitError(
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  751)         "packed rank must equal unpacked rank + blocking factors");
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  752)   }
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  753) 
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  754)   // Verify result shape is greater than the minimum expected
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  755)   // by the pack operation, and that the output shape
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  756)   // represents full tiles.
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  757)   ShapedType expectedPackedType = PackOp::getPackedType(
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  758)       unpackedType, packOrUnPack.getStaticTiles(), innerDimsPos, outerDimPerm);
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  759)   if (!isSmallerThan(expectedPackedType.getShape(), packedType.getShape())) {
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  760)     return op->emitError("the shape of output is not large enough to hold the "
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  761)                          "packed data. Expected at least ")
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  762)            << expectedPackedType << ", got " << packedType;
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  763)   }
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  764)   if (!llvm::all_of(
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  765)           llvm::zip_equal(packedType.getShape().take_back(mixedTiles.size()),
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  766)                           mixedTiles),
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  767)           [](std::tuple<int64_t, OpFoldResult> it) {
6109e0c39f8 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Jacques Pienaar    2023-03-23 10:07:20 -0700  768)             std::optional<int64_t> constTileSize =
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  769)                 getConstantIntValue(std::get<1>(it));
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  770)             int64_t shape = std::get<0>(it);
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  771)             if (!constTileSize) {
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  772)               // If specified tile size is dynamic, output shape should
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  773)               // be dynamic too.
ef35fa2dc8f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2023-12-07 16:43:04 -0800  774)               return ShapedType::isDynamic(shape);
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  775)             } else {
ef35fa2dc8f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2023-12-07 16:43:04 -0800  776)               if (ShapedType::isDynamic(shape)) {
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  777)                 // For the shape being dynamic when tile size is
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  778)                 // specified, return true. In canonical form a constant
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  779)                 // tile size should lead to constant shape of the tiled
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  780)                 // dimension, but not needed for verification.
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  781)                 return true;
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  782)               }
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  783)               return shape == constTileSize.value();
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  784)             }
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  785)           })) {
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  786)     return op->emitError("mismatch in inner tile sizes specified and shaped of "
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  787)                          "tiled dimension in the packed type");
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  788)   }
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  789)   return success();
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  790) }
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  791) 
4d3cb377574 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-10-07 07:16:07 +0800  792) //===----------------------------------------------------------------------===//
4d3cb377574 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-10-07 07:16:07 +0800  793) // PackOp
4d3cb377574 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-10-07 07:16:07 +0800  794) //===----------------------------------------------------------------------===//
4d3cb377574 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-10-07 07:16:07 +0800  795) 
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  796) /// Custom builder methods for pack ops.
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  797) void PackOp::build(OpBuilder &builder, OperationState &state, Value source,
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  798)                    Value output, ArrayRef<int64_t> innerDimsPos,
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  799)                    ArrayRef<OpFoldResult> innerTiles,
6109e0c39f8 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Jacques Pienaar    2023-03-23 10:07:20 -0700  800)                    std::optional<Value> paddingValue,
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  801)                    ArrayRef<int64_t> outerDimsPerm) {
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  802)   assert(innerDimsPos.size() == innerTiles.size() &&
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  803)          "number of tile sizes specified must match the specified number of "
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  804)          "original dimensions to be tiled");
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  805)   SmallVector<int64_t> staticTileSizes;
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  806)   SmallVector<Value> dynamicTileSizes;
79b90d32d17 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Lei Zhang          2022-12-16 13:37:34 -0800  807)   dispatchIndexOpFoldResults(innerTiles, dynamicTileSizes, staticTileSizes);
b02dfa948b7 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2023-02-13 12:41:24 -0800  808)   SmallVector<Type> resultType;
b02dfa948b7 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2023-02-13 12:41:24 -0800  809)   auto outputType = output.getType();
714bf6073d5 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Jorn Tuyls         2024-04-25 23:59:41 +0200  810)   if (isa<RankedTensorType>(outputType)) {
b02dfa948b7 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2023-02-13 12:41:24 -0800  811)     resultType.push_back(outputType);
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  812)   }
b02dfa948b7 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2023-02-13 12:41:24 -0800  813)   build(builder, state, resultType, source, output,
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  814)         outerDimsPerm.empty() ? nullptr
b576330ffbb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Thomas             2022-11-29 22:21:35 -0800  815)                               : builder.getDenseI64ArrayAttr(outerDimsPerm),
b576330ffbb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Thomas             2022-11-29 22:21:35 -0800  816)         builder.getDenseI64ArrayAttr(innerDimsPos), dynamicTileSizes,
b576330ffbb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Thomas             2022-11-29 22:21:35 -0800  817)         builder.getDenseI64ArrayAttr(staticTileSizes),
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  818)         (paddingValue ? paddingValue.value() : nullptr));
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  819) }
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  820) 
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  821) LogicalResult PackOp::verify() {
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  822)   if (failed(commonVerifierPackAndUnPackOp(*this))) {
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  823)     return failure();
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  824)   }
20ef4097688 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-07 23:51:50 +0200  825) 
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  826)   // Bail out if the tile does not divide the dimension fully. In the case of
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  827)   // dynamic tile factors or dimensions, having a partial tile is undefined
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  828)   // behavior.
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  829)   auto dimAndTileMapping = getDimAndTileMapping();
300ed02e33d llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-09-30 00:28:37 +0800  830)   if (!getPaddingValue() &&
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  831)       areNotFullTiles(getInputShape(), dimAndTileMapping)) {
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  832)     return emitOpError("invalid tile factor provided. Only full tiles are "
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  833)                        "supported when padding_value is not set");
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  834)   }
300ed02e33d llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-09-30 00:28:37 +0800  835) 
300ed02e33d llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-09-30 00:28:37 +0800  836)   if (auto paddingValue = getPaddingValue()) {
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  837)     if (paddingValue.getType() != getInputType().getElementType()) {
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  838)       return emitOpError("expected padding_value has ")
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  839)              << getInputType().getElementType()
300ed02e33d llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-09-30 00:28:37 +0800  840)              << " but got: " << paddingValue.getType();
300ed02e33d llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-09-30 00:28:37 +0800  841)     }
300ed02e33d llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-09-30 00:28:37 +0800  842)   }
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  843)   return success();
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  844) }
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  845) 
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  846) SmallVector<OpFoldResult> PackOp::getMixedTiles() {
fdfe344a8b7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-04-17 10:08:53 -0700  847)   return LinalgExt::getMixedTiles(*this);
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  848) }
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  849) 
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  850) SmallVector<int64_t> PackOp::getStaticTiles() {
fdfe344a8b7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-04-17 10:08:53 -0700  851)   return LinalgExt::getStaticTiles(*this);
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  852) }
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  853) 
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  854) // Helper for PackOp::{getResultShape,getPackedType}. Returns the shape of the
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  855) // packed type. Having a shared helper helps implement these two methods in a
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  856) // way that ensures that they agree on which dimensions are dynamic.
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  857) static SmallVector<int64_t> getPackOpResultTypeShape(
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  858)     ArrayRef<int64_t> sourceShape, ArrayRef<int64_t> innerTileSizes,
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  859)     ArrayRef<int64_t> innerDimsPos, ArrayRef<int64_t> outerDimsPerm) {
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  860)   SmallVector<int64_t> resultShape = llvm::to_vector(sourceShape);
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  861)   for (auto [idx, tiledDim] : llvm::enumerate(innerDimsPos)) {
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  862)     if (ShapedType::isDynamic(resultShape[tiledDim])) {
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  863)       continue;
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  864)     }
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  865)     if (ShapedType::isDynamic(innerTileSizes[idx])) {
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  866)       resultShape[tiledDim] = ShapedType::kDynamic;
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  867)       continue;
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  868)     }
ac418d1f45d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Lei Zhang          2024-06-20 19:24:08 -0700  869)     resultShape[tiledDim] =
ac418d1f45d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Lei Zhang          2024-06-20 19:24:08 -0700  870)         llvm::divideCeil(resultShape[tiledDim], innerTileSizes[idx]);
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  871)   }
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  872) 
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  873)   // Swap tile loops if outer_dims_perm is available.
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  874)   resultShape = interchange<int64_t>(resultShape, outerDimsPerm, /*offset=*/0);
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  875) 
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  876)   // Append the inner tile dimensions.
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  877)   resultShape.append(innerTileSizes.begin(), innerTileSizes.end());
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  878)   return resultShape;
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  879) }
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  880) 
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  881) SmallVector<OpFoldResult> PackOp::getResultShape(
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  882)     OpBuilder &builder, Location loc, ArrayRef<OpFoldResult> sourceDims,
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  883)     ArrayRef<OpFoldResult> innerTileSizes, ArrayRef<int64_t> innerDimsPos,
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  884)     ArrayRef<int64_t> outerDimsPerm) {
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  885)   SmallVector<OpFoldResult> resultDims = llvm::to_vector(sourceDims);
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  886) 
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  887)   AffineExpr s0, s1;
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  888)   bindSymbols(builder.getContext(), s0, s1);
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  889)   AffineExpr ceilDivExpr = s0.ceilDiv(s1);
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  890)   for (auto [idx, tiledDim] : llvm::enumerate(innerDimsPos)) {
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  891)     resultDims[tiledDim] = affine::makeComposedFoldedAffineApply(
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  892)         builder, loc, ceilDivExpr, {resultDims[tiledDim], innerTileSizes[idx]});
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  893)   }
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  894)   if (!outerDimsPerm.empty()) {
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  895)     resultDims =
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  896)         interchange<OpFoldResult>(resultDims, outerDimsPerm, /*offset=*/0);
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  897)   }
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  898)   resultDims.append(innerTileSizes.begin(), innerTileSizes.end());
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  899) 
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  900)   SmallVector<int64_t> resultTypeShape =
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  901)       getPackOpResultTypeShape(asShapeWithAnyValueAsDynamic(sourceDims),
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  902)                                asShapeWithAnyValueAsDynamic(innerTileSizes),
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  903)                                innerDimsPos, outerDimsPerm);
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  904) 
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  905)   // Fix-up `resultDims` to ensure that they are Value's if and only if the
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  906)   // result type shape says it's a dynamic dim. This is needed as callers may
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  907)   // use dispatchIndexOpFoldResults on the result, and rely on exact number of
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  908)   // dynamic dims returned by that.
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  909)   for (unsigned i = 0; i < resultDims.size(); ++i) {
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  910)     if (!ShapedType::isDynamic(resultTypeShape[i])) {
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  911)       continue;
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  912)     }
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  913)     resultDims[i] =
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  914)         getValueOrCreateConstantIndexOp(builder, loc, resultDims[i]);
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  915)   }
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  916) 
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  917)   return resultDims;
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  918) }
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  919) 
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  920) SmallVector<OpFoldResult> PackOp::getResultShape(OpBuilder &builder) {
2b7d51ebce8 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2023-06-24 16:14:04 -0700  921)   return tensor::getMixedSizes(builder, getLoc(), getOutput());
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  922) }
4db106be05a llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 20:06:38 -0700  923) 
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  924) ShapedType PackOp::getPackedType(ShapedType sourceType,
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  925)                                  ArrayRef<int64_t> innerTileSizes,
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  926)                                  ArrayRef<int64_t> innerDimsPos,
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  927)                                  ArrayRef<int64_t> outerDimsPerm) {
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  928)   SmallVector<int64_t> resultTypeShape = getPackOpResultTypeShape(
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  929)       sourceType.getShape(), innerTileSizes, innerDimsPos, outerDimsPerm);
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  930) 
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  931)   return TypeSwitch<ShapedType, ShapedType>(sourceType)
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  932)       .Case<RankedTensorType>([&](auto shapedType) {
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  933)         return RankedTensorType::get(resultTypeShape,
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  934)                                      shapedType.getElementType());
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  935)       })
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  936)       .Case<MemRefType>([&](auto shapedType) {
1d8d7fe470e llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (bjacob             2022-12-13 11:58:41 -0500  937)         return MemRefType::get(resultTypeShape, shapedType.getElementType());
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  938)       })
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  939)       .Default([&](Type t) {
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  940)         assert(false && "unexpected type");
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  941)         return nullptr;
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  942)       });
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  943) }
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  944) 
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  945) DenseMap<int64_t, OpFoldResult> PackOp::getDimAndTileMapping() {
fdfe344a8b7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-04-17 10:08:53 -0700  946)   return LinalgExt::getDimAndTileMapping(*this);
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  947) }
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  948) 
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  949) LogicalResult
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  950) PackOp::reifyResultShapes(OpBuilder &builder,
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  951)                           ReifiedRankedShapedTypeDims &reifiedReturnShapes) {
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  952)   return cast<LinalgExtOp>(getOperation())
f0d2cad2b28 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-11-04 12:17:36 -0700  953)       .reifyResultShapes(builder, reifiedReturnShapes);
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  954) }
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200  955) 
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  956) //===----------------------------------------------------------------------===//
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  957) // UnPackOp
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  958) //===----------------------------------------------------------------------===//
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  959) 
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  960) /// Custom builder methods for unpack ops.
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  961) void UnPackOp::build(OpBuilder &builder, OperationState &state, Value source,
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  962)                      Value output, ArrayRef<int64_t> innerDimsPos,
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  963)                      ArrayRef<OpFoldResult> innerTiles,
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  964)                      ArrayRef<int64_t> outerDimsPerm) {
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  965)   SmallVector<int64_t> staticTileSizes;
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  966)   SmallVector<Value> dynamicTileSizes;
79b90d32d17 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Lei Zhang          2022-12-16 13:37:34 -0800  967)   dispatchIndexOpFoldResults(innerTiles, dynamicTileSizes, staticTileSizes);
b02dfa948b7 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2023-02-13 12:41:24 -0800  968)   SmallVector<Type> resultType;
b02dfa948b7 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2023-02-13 12:41:24 -0800  969)   auto outputType = output.getType();
714bf6073d5 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Jorn Tuyls         2024-04-25 23:59:41 +0200  970)   if (isa<RankedTensorType>(outputType)) {
b02dfa948b7 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2023-02-13 12:41:24 -0800  971)     resultType.push_back(outputType);
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800  972)   }
b02dfa948b7 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2023-02-13 12:41:24 -0800  973)   build(builder, state, resultType, source, output,
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  974)         outerDimsPerm.empty() ? nullptr
b576330ffbb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Thomas             2022-11-29 22:21:35 -0800  975)                               : builder.getDenseI64ArrayAttr(outerDimsPerm),
b576330ffbb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Thomas             2022-11-29 22:21:35 -0800  976)         builder.getDenseI64ArrayAttr(innerDimsPos), dynamicTileSizes,
b576330ffbb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Thomas             2022-11-29 22:21:35 -0800  977)         builder.getDenseI64ArrayAttr(staticTileSizes));
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  978) }
9cf4af20947 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-12 10:22:31 -0700  979) 
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  980) SmallVector<OpFoldResult> UnPackOp::getMixedTiles() {
fdfe344a8b7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-04-17 10:08:53 -0700  981)   return LinalgExt::getMixedTiles(*this);
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  982) }
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  983) 
4d3cb377574 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-10-07 07:16:07 +0800  984) SmallVector<int64_t> UnPackOp::getStaticTiles() {
fdfe344a8b7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-04-17 10:08:53 -0700  985)   return LinalgExt::getStaticTiles(*this);
4d3cb377574 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-10-07 07:16:07 +0800  986) }
4d3cb377574 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-10-07 07:16:07 +0800  987) 
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  988) DenseMap<int64_t, OpFoldResult> UnPackOp::getDimAndTileMapping() {
fdfe344a8b7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-04-17 10:08:53 -0700  989)   return LinalgExt::getDimAndTileMapping(*this);
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  990) }
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  991) 
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  992) LogicalResult
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  993) UnPackOp::reifyResultShapes(OpBuilder &builder,
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  994)                             ReifiedRankedShapedTypeDims &reifiedReturnShapes) {
4d3cb377574 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-10-07 07:16:07 +0800  995)   return cast<LinalgExtOp>(getOperation())
4d3cb377574 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2022-10-07 07:16:07 +0800  996)       .reifyResultShapes(builder, reifiedReturnShapes);
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  997) }
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  998) 
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200  999) LogicalResult UnPackOp::verify() {
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200 1000)   if (failed(commonVerifierPackAndUnPackOp(*this))) {
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200 1001)     return failure();
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200 1002)   }
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200 1003)   return success();
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200 1004) }
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200 1005) 
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1006) //===----------------------------------------------------------------------===//
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1007) // WinogradInputTransformOp
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1008) //===----------------------------------------------------------------------===//
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1009) 
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1010) LogicalResult WinogradInputTransformOp::verify() {
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1011)   Operation *op = getOperation();
de51b222886 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2023-09-25 17:25:02 -0700 1012)   if (getNumDpsInputs() != 1) {
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1013)     return op->emitOpError("expected one input operand");
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1014)   }
de51b222886 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2023-09-25 17:25:02 -0700 1015)   if (getNumDpsInits() != 1) {
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1016)     return op->emitOpError("expected one output operand");
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1017)   }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1018)   auto inputType = getInputType();
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1019)   auto outputType = getOutputType();
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1020)   if (outputType.getElementType() != inputType.getElementType()) {
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1021)     return op->emitOpError(
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1022)         "expected input/output element types to be identical");
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1023)   }
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1024)   unsigned inputRank = inputType.getRank();
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1025)   unsigned outputRank = outputType.getRank();
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1026) 
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1027)   if (inputRank != 2 && inputRank != 4) {
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1028)     return op->emitOpError("expected input operand to have rank either 2 or 4");
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1029)   }
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1030) 
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1031)   if (inputRank == 2) {
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1032)     if (outputRank != 2) {
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1033)       return op->emitOpError(
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1034)           "expected output operand to have rank 2 if input is of rank 2");
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1035)     }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1036)     if ((!inputType.isDynamicDim(0) &&
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1037)          inputType.getDimSize(0) > getInputTileSize()) ||
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1038)         (inputType.isDynamicDim(1) &&
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1039)          inputType.getDimSize(1) > getInputTileSize())) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1040)       return op->emitOpError("expected input dims not greater than input tile "
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1041)                              "size if input is of rank 2");
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1042)     }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1043)     SmallVector<int64_t> expectedOutputShape(2, getInputTileSize());
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1044)     if (failed(verifyCompatibleShape(expectedOutputShape,
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1045)                                      outputType.getShape()))) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1046)       return op->emitOpError(
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1047)           "expected output dims equal to inputTileSize if input is of rank 2");
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1048)     }
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1049)     return success();
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1050)   }
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1051) 
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1052)   if (getOutputRank() != getInputRank() + 2) {
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1053)     return op->emitOpError(
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1054)         "expected output rank to be equal to input rank + 2");
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1055)   }
c81496c512d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-05-10 07:16:50 -0700 1056)   ArrayRef<int64_t> imageDims = getImageDimensions();
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1057)   llvm::SmallSetVector<int64_t, 2> imageDimsSet(imageDims.begin(),
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1058)                                                 imageDims.end());
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1059)   if (imageDims.size() != 2) {
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1060)     return op->emitOpError("expected only 2 image dimensions");
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1061)   }
d16b02f6a13 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-12-14 16:26:51 -0800 1062)   if (!isNchw() && !isNhwc()) {
d16b02f6a13 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-12-14 16:26:51 -0800 1063)     return op->emitOpError(
d16b02f6a13 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-12-14 16:26:51 -0800 1064)         "expect image dimensions to be either [1, 2] or [2, 3]");
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1065)   }
c81496c512d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-05-10 07:16:50 -0700 1066)   SmallVector<int64_t> expectedOutputShape(getOutputRank(), getInputTileSize());
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1067)   int outputIndex;
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1068)   ArrayRef<int64_t> inputShape = inputType.getShape();
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1069)   for (int i = 0; i < inputShape.size(); i++) {
c81496c512d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-05-10 07:16:50 -0700 1070)     outputIndex = i + imageDims.size();
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1071)     if (ShapedType::isDynamic(inputShape[i])) {
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1072)       expectedOutputShape[outputIndex] = inputShape[i];
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1073)       continue;
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1074)     }
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1075)     if (!imageDimsSet.contains(i)) {
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1076)       expectedOutputShape[outputIndex] = inputShape[i];
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1077)     } else {
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1078)       expectedOutputShape[outputIndex] =
c81496c512d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-05-10 07:16:50 -0700 1079)           std::ceil(static_cast<float>(inputShape[i] - getKernelSize() + 1) /
c81496c512d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-05-10 07:16:50 -0700 1080)                     getOutputTileSize());
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1081)     }
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1082)   }
d16b02f6a13 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-12-14 16:26:51 -0800 1083)   if (isNchw()) {
d16b02f6a13 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-12-14 16:26:51 -0800 1084)     permute<Permutation::TTNCHW_TO_TTNHWC>(expectedOutputShape);
d16b02f6a13 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-12-14 16:26:51 -0800 1085)   }
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1086)   ArrayRef<int64_t> outputShape = outputType.getShape();
6d4aadbe92f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2023-02-16 14:41:34 -0800 1087)   if (failed(verifyCompatibleShape(expectedOutputShape, outputShape))) {
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1088)     return op->emitOpError("incompatible output shape");
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1089)   }
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1090)   return success();
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1091) }
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1092) 
a61c0e2a3ad llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2023-01-31 13:40:37 -0800 1093) LogicalResult WinogradInputTransformOp::fold(FoldAdaptor,
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1094)                                              SmallVectorImpl<OpFoldResult> &) {
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1095)   return memref::foldMemRefCast(*this);
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1096) }
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1097) 
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1098) LogicalResult WinogradInputTransformOp::reifyResultShapes(
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1099)     OpBuilder &b, ReifiedRankedShapedTypeDims &reifiedReturnShapes) {
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1100)   return cast<LinalgExtOp>(getOperation())
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1101)       .reifyResultShapes(b, reifiedReturnShapes);
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1102) }
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 1103) 
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1104) //===----------------------------------------------------------------------===//
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1105) // WinogradFilterTransformOp
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1106) //===----------------------------------------------------------------------===//
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1107) 
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1108) LogicalResult WinogradFilterTransformOp::verify() {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1109)   Operation *op = getOperation();
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1110)   if (getNumDpsInputs() != 1) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1111)     return op->emitOpError("expected one input operand");
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1112)   }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1113)   if (getNumDpsInits() != 1) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1114)     return op->emitOpError("expected one output operand");
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1115)   }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1116)   auto inputType = getInputType();
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1117)   auto outputType = getOutputType();
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1118)   if (outputType.getElementType() != inputType.getElementType()) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1119)     return op->emitOpError(
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1120)         "expected input/output element types to be identical");
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1121)   }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1122)   unsigned inputRank = inputType.getRank();
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1123)   unsigned outputRank = outputType.getRank();
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1124) 
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1125)   if (inputRank != 2 && inputRank != 4) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1126)     return op->emitOpError("expected input operand to have rank either 2 or 4");
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1127)   }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1128) 
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1129)   if (inputRank == 2) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1130)     if (outputRank != 2) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1131)       return op->emitOpError(
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1132)           "expected output operand to have rank 2 if input is of rank 2");
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1133)     }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1134)     SmallVector<int64_t> expectedInputShape(2, getKernelSize());
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1135)     if (failed(
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1136)             verifyCompatibleShape(expectedInputShape, inputType.getShape()))) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1137)       return op->emitOpError("expected input dims to be equal to kernel size "
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1138)                              "if input is of rank 2");
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1139)     }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1140)     SmallVector<int64_t> expectedOutputShape(2, getInputTileSize());
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1141)     if (failed(verifyCompatibleShape(expectedOutputShape,
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1142)                                      outputType.getShape()))) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1143)       return op->emitOpError("expected output dims equal to input tile size if "
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1144)                              "input is of rank 2");
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1145)     }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1146)     return success();
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1147)   }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1148) 
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1149)   if (getOutputRank() != getInputRank()) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1150)     return op->emitOpError("expected output rank to be equal to input rank");
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1151)   }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1152)   const ArrayRef<int64_t> kernelDims = getKernelDimensions();
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1153)   if (kernelDims.size() != 2) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1154)     return op->emitOpError("expected only 2 kernel dimensions");
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1155)   }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1156)   if (!isHwcf() && !isFchw()) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1157)     return op->emitOpError(
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1158)         "expect kernel dimensions to be either [0, 1] or [2, 3]");
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1159)   }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1160)   const int64_t kernelSize = getKernelSize();
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1161)   for (auto kernelDim : kernelDims) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1162)     if (inputType.getDimSize(kernelDim) != kernelSize) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1163)       return op->emitOpError(
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1164)           "expect all kernel dimensions to have the kernel size");
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1165)     }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1166)   }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1167)   const int64_t inputTileSize = getInputTileSize();
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1168)   SmallVector<int64_t> expectedOutputShape(kernelDims.size(), inputTileSize);
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1169)   llvm::SmallSetVector<int64_t, 2> kernelDimsSet(kernelDims.begin(),
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1170)                                                  kernelDims.end());
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1171)   for (int i = 0; i < inputType.getRank(); i++) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1172)     if (!kernelDimsSet.contains(i)) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1173)       expectedOutputShape.push_back(inputType.getDimSize(i));
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1174)     }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1175)   }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1176)   if (isFchw()) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1177)     permute<Permutation::TTFC_TO_TTCF>(expectedOutputShape);
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1178)   }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1179)   ArrayRef<int64_t> outputShape = outputType.getShape();
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1180)   if (failed(verifyCompatibleShape(expectedOutputShape, outputShape))) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1181)     return op->emitOpError("incompatible output shape");
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1182)   }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1183)   return success();
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1184) }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1185) 
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1186) LogicalResult WinogradFilterTransformOp::fold(FoldAdaptor,
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1187)                                               SmallVectorImpl<OpFoldResult> &) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1188)   return memref::foldMemRefCast(*this);
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1189) }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1190) 
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1191) LogicalResult WinogradFilterTransformOp::reifyResultShapes(
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1192)     OpBuilder &b, ReifiedRankedShapedTypeDims &reifiedReturnShapes) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1193)   return cast<LinalgExtOp>(getOperation())
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1194)       .reifyResultShapes(b, reifiedReturnShapes);
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1195) }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1196) 
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1197) //===----------------------------------------------------------------------===//
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1198) // WinogradOutputTransformOp
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1199) //===----------------------------------------------------------------------===//
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1200) 
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1201) LogicalResult WinogradOutputTransformOp::verify() {
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1202)   Operation *op = getOperation();
de51b222886 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2023-09-25 17:25:02 -0700 1203)   if (getNumDpsInputs() != 1) {
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1204)     return op->emitOpError("expected one input operand");
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1205)   }
de51b222886 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Stella Laurenzo    2023-09-25 17:25:02 -0700 1206)   if (getNumDpsInits() != 1) {
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1207)     return op->emitOpError("expected one output operand");
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1208)   }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1209)   auto inputType = getInputType();
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1210)   auto outputType = getOutputType();
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1211)   unsigned inputRank = inputType.getRank();
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1212)   unsigned outputRank = outputType.getRank();
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1213) 
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1214)   if (inputRank != 2 && inputRank != 6) {
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1215)     return op->emitOpError("expected input operand to have rank either 2 or 6");
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1216)   }
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1217) 
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1218)   if (inputRank == 2) {
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1219)     if (outputRank != 2) {
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1220)       return op->emitOpError(
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1221)           "expected output operand to have rank 2 if input is of rank 2");
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1222)     }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1223)     SmallVector<int64_t> expectedInputShape(2, getInputTileSize());
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1224)     if (failed(
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1225)             verifyCompatibleShape(expectedInputShape, inputType.getShape()))) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1226)       return op->emitOpError("expected input dims to be equal to input tile "
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1227)                              "size if input is of rank 2");
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1228)     }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1229)     SmallVector<int64_t> expectedOutputShape(2, getOutputTileSize());
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1230)     if (failed(verifyCompatibleShape(expectedOutputShape,
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1231)                                      outputType.getShape()))) {
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1232)       return op->emitOpError("expected output dims equal to output tile size "
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1233)                              "if input is of rank 2");
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1234)     }
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1235)     return success();
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1236)   }
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1237)   ArrayRef<int64_t> outputShape = outputType.getShape();
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1238)   if (outputType.getElementType() != inputType.getElementType()) {
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1239)     return op->emitOpError(
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1240)         "expected input/output element types to be identical");
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1241)   }
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1242)   if (outputRank != inputRank - 2) {
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1243)     return op->emitOpError(
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1244)         "expected output rank to be equal to input rank - 2");
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1245)   }
c81496c512d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-05-10 07:16:50 -0700 1246)   ArrayRef<int64_t> imageDims = getImageDimensions();
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1247)   llvm::SmallSetVector<int64_t, 2> imageDimsSet(imageDims.begin(),
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1248)                                                 imageDims.end());
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1249)   if (imageDims.size() != 2) {
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1250)     return op->emitOpError("expected only 2 image dimensions");
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1251)   }
d16b02f6a13 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-12-14 16:26:51 -0800 1252)   if (!isNchw() && !isNhwc()) {
d16b02f6a13 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-12-14 16:26:51 -0800 1253)     return op->emitOpError(
d16b02f6a13 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-12-14 16:26:51 -0800 1254)         "expect image dimensions to be either [1, 2] or [2, 3]");
d16b02f6a13 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-12-14 16:26:51 -0800 1255)   }
39afb04919f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-27 23:34:09 +0530 1256)   SmallVector<int64_t> inputShape(inputType.getShape());
d16b02f6a13 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-12-14 16:26:51 -0800 1257)   if (isNchw()) {
d16b02f6a13 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-12-14 16:26:51 -0800 1258)     permute<Permutation::TTNHWC_TO_TTNCHW>(inputShape);
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1259)   }
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 1260)   SmallVector<int64_t> expectedOutputShape(getOutputRank(), 1);
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1261)   int outputIndex;
c81496c512d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-05-10 07:16:50 -0700 1262)   for (int i = imageDims.size(); i < inputShape.size(); i++) {
c81496c512d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-05-10 07:16:50 -0700 1263)     outputIndex = i - imageDims.size();
886c4169acb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-18 16:30:31 -0400 1264)     if (ShapedType::isDynamic(inputShape[i])) {
886c4169acb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-18 16:30:31 -0400 1265)       expectedOutputShape[outputIndex] = inputShape[i];
886c4169acb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-18 16:30:31 -0400 1266)       continue;
886c4169acb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-18 16:30:31 -0400 1267)     }
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1268)     if (!imageDimsSet.contains(outputIndex)) {
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1269)       expectedOutputShape[outputIndex] = inputShape[i];
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1270)     } else {
c81496c512d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-05-10 07:16:50 -0700 1271)       expectedOutputShape[outputIndex] = getOutputTileSize() * inputShape[i];
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1272)     }
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1273)   }
6d4aadbe92f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Han-Chung Wang     2023-02-16 14:41:34 -0800 1274)   if (failed(verifyCompatibleShape(expectedOutputShape, outputShape))) {
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1275)     return op->emitOpError("incompatible output shape");
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1276)   }
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1277)   return success();
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1278) }
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1279) 
a61c0e2a3ad llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2023-01-31 13:40:37 -0800 1280) LogicalResult WinogradOutputTransformOp::fold(FoldAdaptor,
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1281)                                               SmallVectorImpl<OpFoldResult> &) {
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1282)   return memref::foldMemRefCast(*this);
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1283) }
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1284) 
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1285) LogicalResult WinogradOutputTransformOp::reifyResultShapes(
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1286)     OpBuilder &b, ReifiedRankedShapedTypeDims &reifiedReturnShapes) {
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1287)   return cast<LinalgExtOp>(getOperation())
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1288)       .reifyResultShapes(b, reifiedReturnShapes);
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1289) }
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 1290) 
8773676fcc0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2023-01-27 09:48:09 -0800 1291) //===----------------------------------------------------------------------===//
8773676fcc0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2023-01-27 09:48:09 -0800 1292) // AttentionOp
8773676fcc0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2023-01-27 09:48:09 -0800 1293) //===----------------------------------------------------------------------===//
8773676fcc0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2023-01-27 09:48:09 -0800 1294) 
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1295) void AttentionOp::build(OpBuilder &odsBuilder, OperationState &odsState,
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1296)                         TypeRange results, Value query, Value key, Value value,
25e5760ca31 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-11 13:15:13 +0100 1297)                         Value scale, Value output, ArrayAttr indexingMaps,
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1298)                         std::optional<Value> mask) {
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1299)   Value maskIn = mask.value_or(Value());
25e5760ca31 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-11 13:15:13 +0100 1300)   build(odsBuilder, odsState, results, query, key, value, scale, maskIn, output,
e66171aa4c9 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-28 18:58:00 +0000 1301)         indexingMaps, DictionaryAttr());
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1302) }
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1303) 
8773676fcc0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2023-01-27 09:48:09 -0800 1304) LogicalResult AttentionOp::verify() {
9d2d7668420 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-11 12:44:21 -0700 1305)   AttentionOp attnOp = *this;
b7c415254fe compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-03-09 18:49:50 +0000 1306) 
9d2d7668420 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-11 12:44:21 -0700 1307)   // Check if indexing maps can represent attention.
6e23ed1c43b compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-07-18 10:43:39 -0700 1308)   SmallVector<AffineMap> indexingMaps = attnOp.getIndexingMapsArray();
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1309)   if (indexingMaps.size() != getOperation()->getNumOperands()) {
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1310)     return attnOp->emitOpError("expected an indexing map for each operand");
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1311)   }
d90aaae4761 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Manupa Karunaratne 2024-11-07 17:49:48 +0000 1312)   FailureOr<AttentionOpDetail> maybeOpInfo = AttentionOpDetail::get(
d90aaae4761 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Manupa Karunaratne 2024-11-07 17:49:48 +0000 1313)       getQueryMap(), getKeyMap(), getValueMap(), getOutputMap());
8dd1db34174 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-08-21 09:24:13 -0700 1314)   if (failed(maybeOpInfo)) {
8dd1db34174 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-08-21 09:24:13 -0700 1315)     return attnOp->emitOpError("failed to verify op's indexing maps");
8dd1db34174 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-08-21 09:24:13 -0700 1316)   }
b7c415254fe compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-03-09 18:49:50 +0000 1317) 
6e23ed1c43b compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-07-18 10:43:39 -0700 1318)   FloatType scaleElementType = dyn_cast<FloatType>(getScale().getType());
6e23ed1c43b compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-07-18 10:43:39 -0700 1319)   if (!scaleElementType) {
6e23ed1c43b compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-07-18 10:43:39 -0700 1320)     return attnOp->emitOpError("expected scale to be of floating point type");
6e23ed1c43b compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-07-18 10:43:39 -0700 1321)   }
6e23ed1c43b compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-07-18 10:43:39 -0700 1322) 
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1323)   // Check shape compatibility based on indexing maps.
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1324)   SmallVector<int64_t> shape(getIterationDomainRank());
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1325)   SmallVector<bool> foundDims(getIterationDomainRank(), false);
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1326)   auto checkShape = [&shape, &foundDims,
9d2d7668420 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-11 12:44:21 -0700 1327)                      &attnOp](StringRef operandName, ArrayRef<int64_t> valShape,
9d2d7668420 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-11 12:44:21 -0700 1328)                               AffineMap indexingMap) -> LogicalResult {
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1329)     if (indexingMap.getNumResults() != valShape.size()) {
9d2d7668420 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-11 12:44:21 -0700 1330)       return attnOp->emitError("Rank Mismatch for ")
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1331)              << operandName << ". Expected: " << indexingMap.getNumResults()
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1332)              << " Got: " << valShape.size();
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1333)     }
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1334)     for (auto [i, dimExpr] : llvm::enumerate(indexingMap.getResults())) {
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1335)       AffineDimExpr dim = cast<AffineDimExpr>(dimExpr);
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1336)       int64_t pos = dim.getPosition();
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1337)       if (ShapedType::isDynamic(valShape[i])) {
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1338)         continue;
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1339)       }
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1340)       if (!foundDims[pos]) {
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1341)         foundDims[pos] = true;
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1342)         shape[pos] = valShape[i];
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1343)       }
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1344)       if (shape[pos] != valShape[i]) {
9d2d7668420 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-11 12:44:21 -0700 1345)         return attnOp->emitError("Shape Mismatch for ")
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1346)                << operandName << " at position " << i
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1347)                << ". Expected: " << shape[pos] << " Got: " << valShape[i];
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1348)       }
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1349)     }
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1350)     return success();
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1351)   };
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1352) 
25e5760ca31 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-11 13:15:13 +0100 1353)   if (failed(checkShape("Query", getQuery().getType().getShape(),
25e5760ca31 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-11 13:15:13 +0100 1354)                         getQueryMap())) ||
25e5760ca31 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-11 13:15:13 +0100 1355)       failed(checkShape("Key", getKey().getType().getShape(), getKeyMap())) ||
25e5760ca31 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-11 13:15:13 +0100 1356)       failed(checkShape("Value", getValue().getType().getShape(),
25e5760ca31 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-11 13:15:13 +0100 1357)                         getValueMap())) ||
25e5760ca31 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-11 13:15:13 +0100 1358)       failed(checkShape("Output", getOutput().getType().getShape(),
25e5760ca31 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-11 13:15:13 +0100 1359)                         getOutputMap()))) {
78e9dbcc2b6 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Abhishek Varma     2023-10-21 20:23:49 +0530 1360)     return failure();
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800 1361)   }
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1362) 
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1363)   // Additional check case if mask exists
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1364)   if (auto maskMap = getMaskMap()) {
25e5760ca31 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-11 13:15:13 +0100 1365)     if (failed(checkShape("Mask", getMask().getType().getShape(), *maskMap)))
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1366)       return failure();
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1367)   }
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1368) 
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1369)   int expectedSymbols = getQueryMap().getNumInputs();
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1370)   auto checkDomain =
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1371)       [&attnOp, &expectedSymbols](StringRef operandName,
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1372)                                   AffineMap indexingMap) -> LogicalResult {
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1373)     if (expectedSymbols != indexingMap.getNumInputs()) {
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1374)       return attnOp->emitError("Mismatched map domain for ")
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1375)              << operandName << ". Expected: " << expectedSymbols
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1376)              << " Got: " << indexingMap.getNumInputs();
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1377)     }
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1378)     return success();
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1379)   };
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1380) 
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1381)   if (failed(checkDomain("Query", getQueryMap())) ||
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1382)       failed(checkDomain("Key", getKeyMap())) ||
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1383)       failed(checkDomain("Value", getValueMap())) ||
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1384)       failed(checkDomain("Scale", getScaleMap())) ||
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1385)       failed(checkDomain("Output", getOutputMap()))) {
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1386)     return failure();
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1387)   }
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1388) 
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1389)   // Additional check case if mask exists
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1390)   if (auto maskMap = getMaskMap()) {
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1391)     if (failed(checkDomain("Mask", *maskMap)))
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1392)       return failure();
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1393)   }
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1394) 
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1395)   auto &block = getRegion().front();
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1396)   auto blockTys = block.getArgumentTypes();
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1397)   if (!isa<FloatType>(blockTys[0]))
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1398)     return attnOp->emitOpError("block argument 0 should be float");
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1399) 
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1400)   auto yieldOp = dyn_cast<IREE::LinalgExt::YieldOp>(block.getTerminator());
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1401)   if (!yieldOp) {
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1402)     return attnOp->emitOpError("expected linalg_ext.yield");
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1403)   }
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1404) 
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1405)   if (yieldOp->getNumOperands() != 1) {
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1406)     return emitOpError("expected only one return");
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1407)   }
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1408) 
8773676fcc0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2023-01-27 09:48:09 -0800 1409)   return success();
8773676fcc0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2023-01-27 09:48:09 -0800 1410) }
8773676fcc0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2023-01-27 09:48:09 -0800 1411) 
25e5760ca31 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-11 13:15:13 +0100 1412) MutableOperandRange AttentionOp::getDpsInitsMutable() {
25e5760ca31 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-11 13:15:13 +0100 1413)   return MutableOperandRange(*this, /*numInputs=*/getMask() ? 5 : 4,
25e5760ca31 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-11 13:15:13 +0100 1414)                              /*numInits=*/1);
8773676fcc0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2023-01-27 09:48:09 -0800 1415) }
8773676fcc0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2023-01-27 09:48:09 -0800 1416) 
8773676fcc0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2023-01-27 09:48:09 -0800 1417) LogicalResult AttentionOp::reifyResultShapes(
8773676fcc0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2023-01-27 09:48:09 -0800 1418)     OpBuilder &b, ReifiedRankedShapedTypeDims &reifiedReturnShapes) {
8773676fcc0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2023-01-27 09:48:09 -0800 1419)   return cast<LinalgExtOp>(getOperation())
8773676fcc0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2023-01-27 09:48:09 -0800 1420)       .reifyResultShapes(b, reifiedReturnShapes);
8773676fcc0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2023-01-27 09:48:09 -0800 1421) }
8773676fcc0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2023-01-27 09:48:09 -0800 1422) 
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1423) SmallVector<AffineMap> AttentionOp::getIndexingMapsArray() {
9d2d7668420 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-11 12:44:21 -0700 1424)   return SmallVector<AffineMap>(
9d2d7668420 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-11 12:44:21 -0700 1425)       getIndexingMaps().getAsValueRange<AffineMapAttr>());
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1426) }
9fe159d99d8 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-05-22 19:21:58 +0100 1427) 
1e6bbb82368 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-14 13:25:49 +0100 1428) FailureOr<SmallVector<int64_t>> AttentionOp::getStaticLoopRanges() {
1e6bbb82368 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-14 13:25:49 +0100 1429)   SmallVector<int64_t> bounds(getIterationDomainRank());
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1430)   SmallVector<bool> dimsFound(getIterationDomainRank(), false);
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1431) 
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1432)   // batch(s), m, k1
25e5760ca31 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-11 13:15:13 +0100 1433)   ArrayRef<int64_t> queryShape = getQuery().getType().getShape();
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1434)   ArrayRef<AffineExpr> queryDims = getQueryMap().getResults();
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1435)   // batch(s), k2, n
25e5760ca31 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-11 13:15:13 +0100 1436)   ArrayRef<int64_t> valueShape = getValue().getType().getShape();
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1437)   ArrayRef<AffineExpr> valueDims = getValueMap().getResults();
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1438) 
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1439)   auto fillSizes = [&](ArrayRef<int64_t> sizes, ArrayRef<AffineExpr> dims) {
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1440)     for (auto [size, dim] : llvm::zip_equal(sizes, dims)) {
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1441)       int pos = cast<AffineDimExpr>(dim).getPosition();
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1442)       if (dimsFound[pos]) {
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1443)         continue;
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1444)       }
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1445)       bounds[pos] = size;
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1446)       dimsFound[pos] = true;
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1447)     }
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1448)   };
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1449)   fillSizes(queryShape, queryDims);
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1450)   fillSizes(valueShape, valueDims);
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1451)   return bounds;
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1452) }
0a00b0131d1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Stanley Winata     2024-07-22 15:06:06 -0700 1453) 
8dd1db34174 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-08-21 09:24:13 -0700 1454) SmallVector<AffineMap> AttentionOp::getIndexingMapsForOperands() {
8dd1db34174 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-08-21 09:24:13 -0700 1455)   auto maps = getIndexingMapsArray();
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1456)   maps.resize(getNumDpsInputs());
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1457)   return maps;
8dd1db34174 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-08-21 09:24:13 -0700 1458) }
8dd1db34174 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-08-21 09:24:13 -0700 1459) 
8dd1db34174 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-08-21 09:24:13 -0700 1460) SmallVector<AffineMap> AttentionOp::getIndexingMapsForResults() {
8dd1db34174 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-08-21 09:24:13 -0700 1461)   auto maps = getIndexingMapsArray();
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1462)   return SmallVector<AffineMap>(maps.begin() + getNumDpsInputs(), maps.end());
8dd1db34174 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-08-21 09:24:13 -0700 1463) }
8dd1db34174 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2024-08-21 09:24:13 -0700 1464) 
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1465) //===----------------------------------------------------------------------===//
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1466) // OnlineAttentionOp
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1467) //===----------------------------------------------------------------------===//
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1468) 
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1469) void OnlineAttentionOp::build(OpBuilder &odsBuilder, OperationState &odsState,
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1470)                               TypeRange results, Value query, Value key,
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1471)                               Value value, Value scale, Value output, Value max,
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1472)                               Value sum, ArrayAttr indexingMaps,
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1473)                               std::optional<Value> mask) {
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1474)   Value maskIn = mask.value_or(Value());
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1475)   build(odsBuilder, odsState, results, query, key, value, maskIn, scale, output,
e66171aa4c9 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-10-28 18:58:00 +0000 1476)         max, sum, indexingMaps, DictionaryAttr());
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1477) }
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1478) 
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1479) LogicalResult OnlineAttentionOp::verify() {
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1480)   OnlineAttentionOp attnOp = *this;
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1481) 
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1482)   SmallVector<AffineMap> indexingMaps = attnOp.getIndexingMapsArray();
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1483) 
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1484)   // Check if indexing maps can represent attention.
d90aaae4761 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Manupa Karunaratne 2024-11-07 17:49:48 +0000 1485)   FailureOr<AttentionOpDetail> maybeOpInfo = AttentionOpDetail::get(
d90aaae4761 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Manupa Karunaratne 2024-11-07 17:49:48 +0000 1486)       getQueryMap(), getKeyMap(), getValueMap(), getOutputMap());
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1487) 
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1488)   // Check shape compatibility based on indexing maps.
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1489)   SmallVector<int64_t> shape(getIterationDomainRank());
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1490)   SmallVector<bool> foundDims(getIterationDomainRank(), false);
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1491)   auto checkShape = [&shape, &foundDims,
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1492)                      &attnOp](StringRef operandName, ArrayRef<int64_t> valShape,
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1493)                               AffineMap indexingMap) -> LogicalResult {
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1494)     if (indexingMap.getNumResults() != valShape.size()) {
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1495)       return attnOp->emitError("Rank Mismatch for ")
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1496)              << operandName << ". Expected: " << indexingMap.getNumResults()
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1497)              << " Got: " << valShape.size();
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1498)     }
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1499)     for (auto [i, dimExpr] : llvm::enumerate(indexingMap.getResults())) {
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1500)       AffineDimExpr dim = cast<AffineDimExpr>(dimExpr);
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1501)       int64_t pos = dim.getPosition();
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1502)       if (ShapedType::isDynamic(valShape[i])) {
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1503)         continue;
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1504)       }
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1505)       if (!foundDims[pos]) {
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1506)         foundDims[pos] = true;
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1507)         shape[pos] = valShape[i];
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1508)       }
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1509)       if (shape[pos] != valShape[i]) {
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1510)         return attnOp->emitError("Shape Mismatch for ")
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1511)                << operandName << ". Expected: " << shape[pos]
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1512)                << " Got: " << valShape[i];
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1513)       }
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1514)     }
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1515)     return success();
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1516)   };
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1517) 
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1518)   if (failed(checkShape("Query", getQuery().getType().getShape(),
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1519)                         getQueryMap())) ||
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1520)       failed(checkShape("Key", getKey().getType().getShape(), getKeyMap())) ||
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1521)       failed(checkShape("Value", getValue().getType().getShape(),
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1522)                         getValueMap())) ||
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1523)       failed(checkShape("Output", getOutput().getType().getShape(),
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1524)                         getOutputMap())) ||
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1525)       failed(checkShape("Max", getMax().getType().getShape(), getMaxMap())) ||
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1526)       failed(checkShape("Sum", getSum().getType().getShape(), getSumMap()))) {
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1527)     return failure();
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1528)   }
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1529) 
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1530)   // Additional check case if mask exists
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1531)   if (auto maskMap = getMaskMap()) {
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1532)     if (failed(checkShape("Mask", getMask().getType().getShape(), *maskMap)))
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1533)       return failure();
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1534)   }
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1535) 
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1536)   int expectedSymbols = getQueryMap().getNumInputs();
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1537)   auto checkDomain =
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1538)       [&attnOp, &expectedSymbols](StringRef operandName,
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1539)                                   AffineMap indexingMap) -> LogicalResult {
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1540)     if (expectedSymbols != indexingMap.getNumInputs()) {
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1541)       return attnOp->emitError("Mismatched map domain for ")
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1542)              << operandName << ". Expected: " << expectedSymbols
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1543)              << " Got: " << indexingMap.getNumInputs();
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1544)     }
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1545)     return success();
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1546)   };
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1547) 
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1548)   if (failed(checkDomain("Query", getQueryMap())) ||
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1549)       failed(checkDomain("Key", getKeyMap())) ||
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1550)       failed(checkDomain("Value", getValueMap())) ||
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1551)       failed(checkDomain("Scale", getScaleMap())) ||
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1552)       failed(checkDomain("Output", getOutputMap())) ||
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1553)       failed(checkDomain("Max", getMaxMap())) ||
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1554)       failed(checkDomain("Sum", getSumMap()))) {
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1555)     return failure();
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1556)   }
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1557) 
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1558)   // Additional check case if mask exists
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1559)   if (auto maskMap = getMaskMap()) {
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1560)     if (failed(checkDomain("Mask", *maskMap)))
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1561)       return failure();
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1562)   }
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1563) 
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1564)   Block &block = attnOp.getRegion().front();
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1565)   auto blockTys = block.getArgumentTypes();
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1566)   if (blockTys.size() != 1) {
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1567)     return attnOp->emitOpError("expects single block argument for score");
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1568)   }
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1569) 
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1570)   if (!isa<FloatType>(blockTys[0])) {
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1571)     return attnOp->emitOpError("block argument 0 should be float");
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1572)   }
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1573) 
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1574)   auto yieldOp = dyn_cast<IREE::LinalgExt::YieldOp>(block.getTerminator());
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1575)   if (!yieldOp) {
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1576)     return attnOp->emitOpError("expected linalg_ext.yield");
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1577)   }
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1578) 
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1579)   if (yieldOp->getNumOperands() != 1) {
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1580)     return emitOpError("expected only one return");
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1581)   }
a488d3826ea compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Rob Suderman       2024-10-16 11:51:37 -0700 1582) 
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1583)   return success();
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1584) }
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1585) 
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1586) MutableOperandRange OnlineAttentionOp::getDpsInitsMutable() {
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1587)   return MutableOperandRange(*this, /*numInputs=*/getMask() ? 5 : 4,
9ee061d2ec3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (rohan-tan-bhowmik  2024-09-21 23:07:18 -0700 1588)                              /*numInits=*/3);
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1589) }
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1590) 
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1591) LogicalResult OnlineAttentionOp::reifyResultShapes(
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1592)     OpBuilder &b, ReifiedRankedShapedTypeDims &reifiedReturnShapes) {
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1593)   return cast<LinalgExtOp>(getOperation())
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1594)       .reifyResultShapes(b, reifiedReturnShapes);
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1595) }
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1596) 
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1597) SmallVector<AffineMap> OnlineAttentionOp::getIndexingMapsArray() {
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1598)   return SmallVector<AffineMap>(
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1599)       getIndexingMaps().getAsValueRange<AffineMapAttr>());
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1600) }
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 1601) 
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1602) //===----------------------------------------------------------------------===//
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1603) // Im2colOp
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1604) //===----------------------------------------------------------------------===//
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1605) 
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1606) /// Return all static and dynamic kernel_size as OpFoldResults.
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1607) SmallVector<OpFoldResult> Im2colOp::getMixedKernelSize() {
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1608)   return LinalgExt::getMixedValues(getContext(), getStaticKernelSize(),
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1609)                                    getKernelSize());
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1610) }
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1611) 
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1612) /// Return all static and dynamic k_offset as OpFoldResults.
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1613) SmallVector<OpFoldResult> Im2colOp::getMixedKOffset() {
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1614)   return LinalgExt::getMixedValues(getContext(), getStaticKOffset(),
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1615)                                    getKOffset());
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1616) }
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1617) 
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1618) /// Return all static and dynamic m_offset as OpFoldResults.
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1619) SmallVector<OpFoldResult> Im2colOp::getMixedMOffset() {
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1620)   return LinalgExt::getMixedValues(getContext(), getStaticMOffset(),
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1621)                                    getMOffset());
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1622) }
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1623) 
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1624) /// Return all static and dynamic k_strides as OpFoldResults.
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1625) SmallVector<OpFoldResult> Im2colOp::getMixedKStrides() {
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1626)   return LinalgExt::getMixedValues(getContext(), getStaticKStrides(),
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1627)                                    getKStrides());
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1628) }
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1629) 
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1630) /// Return all static and dynamic m_strides as OpFoldResults.
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1631) SmallVector<OpFoldResult> Im2colOp::getMixedMStrides() {
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1632)   return LinalgExt::getMixedValues(getContext(), getStaticMStrides(),
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1633)                                    getMStrides());
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1634) }
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1635) 
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1636) void Im2colOp::setMixedKOffset(SmallVector<OpFoldResult> kOffset) {
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1637)   SmallVector<int64_t> staticKOffset;
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1638)   SmallVector<Value> dynamicKOffset;
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1639)   dispatchIndexOpFoldResults(kOffset, dynamicKOffset, staticKOffset);
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1640)   setStaticKOffset(staticKOffset);
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1641)   getKOffsetMutable().assign(dynamicKOffset);
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1642) }
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1643) 
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1644) void Im2colOp::setMixedMOffset(SmallVector<OpFoldResult> mOffset) {
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1645)   SmallVector<int64_t> staticMOffset;
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1646)   SmallVector<Value> dynamicMOffset;
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1647)   dispatchIndexOpFoldResults(mOffset, dynamicMOffset, staticMOffset);
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1648)   setStaticMOffset(staticMOffset);
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1649)   getMOffsetMutable().assign(dynamicMOffset);
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1650) }
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1651) 
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1652) void Im2colOp::setMixedKStrides(SmallVector<OpFoldResult> kStrides) {
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1653)   SmallVector<int64_t> staticKStrides;
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1654)   SmallVector<Value> dynamicKStrides;
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1655)   dispatchIndexOpFoldResults(kStrides, dynamicKStrides, staticKStrides);
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1656)   setStaticKStrides(staticKStrides);
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1657)   getKStridesMutable().assign(dynamicKStrides);
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1658) }
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1659) 
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1660) void Im2colOp::setMixedMStrides(SmallVector<OpFoldResult> mStrides) {
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1661)   SmallVector<int64_t> staticMStrides;
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1662)   SmallVector<Value> dynamicMStrides;
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1663)   dispatchIndexOpFoldResults(mStrides, dynamicMStrides, staticMStrides);
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1664)   setStaticMStrides(staticMStrides);
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1665)   getMStridesMutable().assign(dynamicMStrides);
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1666) }
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1667) 
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1668) SmallVector<int64_t> Im2colOp::getBatchOutputDims() {
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1669)   return llvm::to_vector(llvm::seq<int64_t>(0, getBatchPos().size()));
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1670) }
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1671) 
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1672) SmallVector<int64_t> Im2colOp::getMOutputDims() {
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1673)   int64_t begin = getBatchPos().size();
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1674)   int64_t end = begin + getMixedMOffset().size();
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1675)   return llvm::to_vector(llvm::seq<int64_t>(begin, end));
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1676) }
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1677) 
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1678) SmallVector<int64_t> Im2colOp::getKOutputDims() {
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1679)   int64_t begin = getBatchPos().size() + getMixedMOffset().size();
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1680)   int64_t end = begin + getMixedKOffset().size();
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1681)   return llvm::to_vector(llvm::seq<int64_t>(begin, end));
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1682) }
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1683) 
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1684) /// Custom builder methods for im2col op.
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1685) void Im2colOp::build(OpBuilder &builder, OperationState &state, Value input,
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1686)                      Value output, ArrayRef<int64_t> strides,
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1687)                      ArrayRef<int64_t> dilations,
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1688)                      ArrayRef<OpFoldResult> kernelSize,
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1689)                      ArrayRef<OpFoldResult> mOffset,
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1690)                      ArrayRef<OpFoldResult> mStrides,
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1691)                      ArrayRef<OpFoldResult> kOffset,
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1692)                      ArrayRef<OpFoldResult> kStrides,
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1693)                      ArrayRef<int64_t> batchPos, ArrayRef<int64_t> mPos,
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1694)                      ArrayRef<int64_t> kPos, ArrayRef<int64_t> inputKPerm) {
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1695)   assert(strides.size() == kernelSize.size() &&
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1696)          dilations.size() == kernelSize.size() &&
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1697)          mPos.size() == kernelSize.size() &&
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1698)          "strides, dilations, m_pos, and kernel expected to be the same rank");
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1699)   SmallVector<int64_t> staticKernelSize, staticMOffset, staticKOffset,
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1700)       staticMStrides, staticKStrides;
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1701)   SmallVector<Value> dynamicKernelSize, dynamicMOffset, dynamicKOffset,
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1702)       dynamicMStrides, dynamicKStrides;
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1703)   dispatchIndexOpFoldResults(kernelSize, dynamicKernelSize, staticKernelSize);
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1704)   dispatchIndexOpFoldResults(mOffset, dynamicMOffset, staticMOffset);
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1705)   dispatchIndexOpFoldResults(mStrides, dynamicMStrides, staticMStrides);
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1706)   dispatchIndexOpFoldResults(kOffset, dynamicKOffset, staticKOffset);
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1707)   dispatchIndexOpFoldResults(kStrides, dynamicKStrides, staticKStrides);
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1708)   SmallVector<Type> resultType;
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1709)   auto outputType = output.getType();
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1710)   if (isa<RankedTensorType>(outputType)) {
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1711)     resultType.push_back(outputType);
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1712)   }
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1713)   build(builder, state, resultType, input, output,
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1714)         builder.getDenseI64ArrayAttr(strides),
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1715)         builder.getDenseI64ArrayAttr(dilations), dynamicKernelSize,
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1716)         builder.getDenseI64ArrayAttr(staticKernelSize), dynamicMOffset,
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1717)         builder.getDenseI64ArrayAttr(staticMOffset), dynamicMStrides,
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1718)         builder.getDenseI64ArrayAttr(staticMStrides), dynamicKOffset,
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1719)         builder.getDenseI64ArrayAttr(staticKOffset), dynamicKStrides,
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1720)         builder.getDenseI64ArrayAttr(staticKStrides),
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1721)         builder.getDenseI64ArrayAttr(batchPos),
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1722)         builder.getDenseI64ArrayAttr(mPos), builder.getDenseI64ArrayAttr(kPos),
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1723)         builder.getDenseI64ArrayAttr(inputKPerm));
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1724) }
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1725) 
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1726) LogicalResult Im2colOp::verify() {
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1727)   Operation *op = getOperation();
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1728)   if (llvm::count_if(getDpsInputs(), [](Value v) {
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1729)         return isa<ShapedType>(v.getType());
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1730)       }) != 1) {
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1731)     return op->emitOpError("expected only one ShapedType operand");
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1732)   }
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1733)   if (getNumDpsInits() != 1) {
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1734)     return op->emitOpError("expected one output operand");
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1735)   }
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1736) 
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1737)   // Verify offsets and strides
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1738)   SmallVector<OpFoldResult> kOffset = getMixedKOffset();
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1739)   SmallVector<OpFoldResult> mOffset = getMixedMOffset();
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1740)   SmallVector<OpFoldResult> kStrides = getMixedKStrides();
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1741)   SmallVector<OpFoldResult> mStrides = getMixedMStrides();
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1742)   if (kOffset.size() < 1) {
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1743)     return op->emitOpError("expected at least one k_offset");
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1744)   }
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1745)   if (mOffset.size() < 1) {
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1746)     return op->emitOpError("expected at least one m_offset");
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1747)   }
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1748)   if (kOffset.size() != kStrides.size()) {
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1749)     return op->emitOpError("expected the same size k_offset and k_strides");
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1750)   }
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1751)   if (mOffset.size() != mStrides.size()) {
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1752)     return op->emitOpError("expected the same size m_offset and m_strides");
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1753)   }
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1754)   std::optional<int64_t> constInnerKStrides =
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1755)       getConstantIntValue(kStrides.back());
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1756)   if (!constInnerKStrides.has_value() || constInnerKStrides.value() != 1) {
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1757)     return op->emitOpError("expected inner k_strides to be 1");
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1758)   }
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1759)   std::optional<int64_t> constInnerMStrides =
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1760)       getConstantIntValue(mStrides.back());
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1761)   if (!constInnerMStrides.has_value() || constInnerMStrides.value() != 1) {
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1762)     return op->emitOpError("expected inner m_strides to be 1");
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1763)   }
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1764) 
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1765)   // Verify operand ranks and dim position sizes.
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1766)   auto inputType = getInputType();
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1767)   unsigned inputRank = inputType.getRank();
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1768)   ArrayRef<int64_t> batchPos = getBatchPos();
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1769)   ArrayRef<int64_t> mPos = getMPos();
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1770)   ArrayRef<int64_t> kPos = getKPos();
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1771)   if (inputRank != batchPos.size() + mPos.size() + kPos.size()) {
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1772)     return op->emitOpError(
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1773)         "expected input rank to be the sum of batch, m, and k ranks");
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1774)   }
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1775)   auto outputType = getOutputType();
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1776)   unsigned outputRank = outputType.getRank();
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1777)   if (outputRank != batchPos.size() + kOffset.size() + mOffset.size()) {
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1778)     return op->emitOpError("expected output rank to be the sum of "
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1779)                            "batch_pos, k_offset, and m_offset ranks");
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1780)   }
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1781) 
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1782)   // Verify convolution metadata.
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1783)   ArrayRef<int64_t> strides = getStrides();
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1784)   ArrayRef<int64_t> dilations = getDilations();
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1785)   SmallVector<OpFoldResult> kernelSize = getMixedKernelSize();
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1786)   ArrayRef<int64_t> inputKPerm = getInputKPerm();
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1787)   if (kernelSize.size() != mPos.size()) {
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1788)     return op->emitOpError(
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1789)         "expected kernel rank to be equal to the m_pos rank");
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1790)   }
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1791)   if (strides.size() != kernelSize.size()) {
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1792)     return op->emitOpError(
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1793)         "expected strides rank to be equal to the kernel rank");
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1794)   }
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1795)   if (dilations.size() != kernelSize.size()) {
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1796)     return op->emitOpError(
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1797)         "expected dilations rank to be equal to the kernel rank");
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1798)   }
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1799) 
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1800)   size_t sharedRank = mPos.size() + kPos.size();
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1801)   if (inputKPerm.size() != sharedRank) {
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1802)     return op->emitOpError("expected input_k_perm size (")
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1803)            << inputKPerm.size()
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1804)            << ") to match the number of shared dimensions (m_Pos + k_pos = "
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1805)            << sharedRank << ")";
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1806)   }
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1807)   SmallVector<int64_t> permVec(inputKPerm.begin(), inputKPerm.end());
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1808)   llvm::sort(permVec);
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1809)   for (int64_t i = 0; i < static_cast<int64_t>(sharedRank); ++i) {
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1810)     if (permVec[i] != i) {
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1811)       return op->emitOpError(
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1812)                  "expected input_k_perm to be a permutation of [0, ")
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1813)              << sharedRank << ")";
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1814)     }
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1815)   }
6dba8b58ad7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Vivian Zhang       2025-04-15 11:50:04 -0700 1816) 
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1817)   // Verify input and output shapes.
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1818)   ArrayRef<int64_t> inputShape = inputType.getShape();
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1819)   ArrayRef<int64_t> outputShape = outputType.getShape();
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1820)   // When the op is tiled, the m and k dimensions of the output are tiled, but
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1821)   // they are not tiled in the input, so we cannot verify the output size of
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1822)   // these dimensions. Only verify the shape of the batch dimensions.
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1823)   SmallVector<int64_t> expectedOutputShape(outputShape);
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1824)   for (auto [idx, pos] : llvm::enumerate(batchPos)) {
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1825)     expectedOutputShape[idx] = inputShape[pos];
598a60e3f9d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-10-09 13:23:06 -0700 1826)   }
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1827)   if (failed(verifyCompatibleShape(expectedOutputShape, outputShape))) {
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1828)     return op->emitOpError("incompatible output shape");
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1829)   }
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1830)   return success();
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1831) }
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1832) 
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1833) LogicalResult Im2colOp::fold(FoldAdaptor, SmallVectorImpl<OpFoldResult> &) {
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1834)   return memref::foldMemRefCast(*this);
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1835) }
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1836) 
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1837) LogicalResult
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1838) Im2colOp::reifyResultShapes(OpBuilder &b,
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1839)                             ReifiedRankedShapedTypeDims &reifiedReturnShapes) {
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1840)   return cast<LinalgExtOp>(getOperation())
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1841)       .reifyResultShapes(b, reifiedReturnShapes);
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1842) }
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 1843) 
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1844) //===---------------------------------------------------------------------===//
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1845) // Custom Op
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1846) //===---------------------------------------------------------------------===//
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1847) 
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1848) unsigned CustomOp::getNumLoops() { return getIteratorTypesAttr().size(); }
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1849) 
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1850) int64_t CustomOp::getRank(Value v) {
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1851)   Type type = v.getType();
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1852)   if (type.isIntOrIndexOrFloat()) {
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1853)     return 0;
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1854)   }
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1855)   return cast<RankedTensorType>(type).getRank();
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1856) }
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1857) 
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 1858) unsigned CustomOp::getNumNonLoopDimensions() {
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 1859)   for (auto map : getIndexingMaps().getAsValueRange<AffineMapAttr>()) {
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 1860)     if (map.isEmpty()) {
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 1861)       continue;
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 1862)     }
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 1863)     return map.getNumSymbols();
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 1864)   }
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 1865)   return 0;
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 1866) }
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 1867) 
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1868) LogicalResult CustomOp::verify() {
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1869)   // All inputs/outputs must have indexing maps.
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1870)   if (static_cast<int64_t>(getIndexingMapsAttr().size()) != getNumOperands()) {
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1871)     return emitOpError("expected number of indexing maps (")
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1872)            << getIndexingMapsAttr().size()
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1873)            << ") to be same as the "
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1874)               "number of input/output operands ("
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1875)            << getNumOperands() << ")";
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1876)   }
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1877) 
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1878)   // Check the form of the indexing maps.
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1879)   std::optional<unsigned> numSymbolDims;
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1880)   for (auto [index, indexingMapAttr, operand] :
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1881)        llvm::enumerate(getIndexingMapsAttr(), getOperands())) {
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1882)     auto indexingMap = cast<AffineMapAttr>(indexingMapAttr).getValue();
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1883)     if (indexingMap.isEmpty()) {
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1884)       continue;
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1885)     }
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1886) 
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1887)     // Domain must be consistent.
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1888)     unsigned numLoops = getNumLoops();
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1889)     if (indexingMap.getNumDims() != numLoops) {
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1890)       return emitOpError("expected indexing_map #")
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1891)              << index << " to have " << numLoops
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1892)              << " dim(s) to match the number of loops or be zero";
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1893)     }
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1894) 
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1895)     // Check that number of symbols is consistent.
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1896)     if (numSymbolDims) {
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1897)       if (indexingMap.getNumSymbols() != numSymbolDims.value()) {
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1898)         return emitOpError(
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1899)                    "inconsistent number of symbol dimensions in indexing_map #")
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1900)                << index << ", expected " << numSymbolDims.value()
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1901)                << " instead of " << indexingMap.getNumSymbols();
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1902)       }
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1903)     } else {
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1904)       numSymbolDims = indexingMap.getNumSymbols();
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1905)     }
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1906) 
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1907)     // Range must match the rank of the operands.
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1908)     int64_t rank = getRank(operand);
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1909)     if (indexingMap.getNumResults() != rank) {
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1910)       return emitOpError("expected operand rank(")
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1911)              << rank << ") to match the result rank of indexing map #" << index;
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1912)     }
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1913)   }
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1914) 
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1915)   // Check that number of basic block arguments is same as number of operands
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1916)   Block *body = getBody();
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1917)   if (body->getNumArguments() != getNumOperands()) {
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1918)     return emitOpError("expected as many basic block arguments (")
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1919)            << body->getNumArguments() << ") as the number of operands ("
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1920)            << getNumOperands() << ")";
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1921)   }
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1922) 
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1923)   // Check that type of the basic block argument matches the type of the
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1924)   // operands.
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1925)   for (auto [index, bbArg, operand] :
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1926)        llvm::enumerate(body->getArguments(), getOperands())) {
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1927)     Type operandType = operand.getType();
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1928)     Type bbArgType = bbArg.getType();
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1929) 
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1930)     if (operandType.isIntOrIndexOrFloat()) {
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1931)       if (operandType != bbArgType) {
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1932)         return emitOpError("for (scalar) operand #")
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1933)                << index
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1934)                << " expected corresponding basic block argument to be of the "
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1935)                   "same type";
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1936)       }
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1937)       continue;
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1938)     }
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1939) 
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1940)     auto operandTensorType = cast<RankedTensorType>(operandType);
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1941)     auto bbArgTensorType = dyn_cast<RankedTensorType>(bbArgType);
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1942)     if (!bbArgTensorType) {
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1943)       return emitOpError("for (tensor) operand #")
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1944)              << index
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1945)              << " expected corresponding basic block argument to be tensor as "
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1946)                 "well";
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1947)     }
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1948) 
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1949)     // Check that the basic block arg has same rank/element type, but all shapes
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1950)     // dynamic.
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1951)     auto expectedBBArgType = RankedTensorType::get(
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1952)         SmallVector<int64_t>(operandTensorType.getRank(), ShapedType::kDynamic),
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1953)         operandTensorType.getElementType(), operandTensorType.getEncoding());
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1954)     if (bbArgTensorType != expectedBBArgType) {
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1955)       return emitOpError("expected basic block argument corresponding to "
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1956)                          "(tensor) operand #")
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1957)              << index << " to be " << expectedBBArgType << " instead of "
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1958)              << bbArgTensorType;
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1959)     }
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1960)   }
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1961) 
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1962)   // Check yield operation operand types.
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1963)   auto yieldOp = cast<IREE::LinalgExt::YieldOp>(body->getTerminator());
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1964)   if (yieldOp->getNumOperands() != getOutputs().size()) {
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1965)     return emitOpError(
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1966)         "expected as many yields as the numbers of `outs` operand");
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1967)   }
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1968) 
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1969)   for (auto [index, yieldVal, bbOperand] :
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1970)        llvm::enumerate(yieldOp.getOperands(),
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1971)                        body->getArguments().take_back(getOutputs().size()))) {
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1972)     if (yieldVal.getType() != bbOperand.getType()) {
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1973)       return emitOpError("expected type of ")
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1974)              << index
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1975)              << "-th operand of yield to match the corresponding output basic "
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1976)                 "block argument";
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1977)     }
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1978)   }
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1979) 
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1980)   return success();
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1981) }
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 1982) 
5f3f863ca26 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 21:40:25 -0700 1983) /// Start `LinalgFusionInterface` implementation.
5f3f863ca26 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 21:40:25 -0700 1984) 
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 1985) SmallVector<AffineMap> CustomOp::getIndexingMapsForOperands() {
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 1986)   return llvm::map_to_vector(
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 1987)       getIndexingMaps().getValue().take_front(getNumDpsInputs()),
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 1988)       [](Attribute attr) { return cast<AffineMapAttr>(attr).getValue(); });
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 1989) }
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 1990) 
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 1991) SmallVector<AffineMap> CustomOp::getIndexingMapsForResults() {
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 1992)   return llvm::map_to_vector(
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 1993)       getIndexingMaps().getValue().take_back(getNumDpsInits()),
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 1994)       [](Attribute attr) { return cast<AffineMapAttr>(attr).getValue(); });
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 1995) }
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 1996) 
5f3f863ca26 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 21:40:25 -0700 1997) /// End `LinalgFusionInterface` implementation
5f3f863ca26 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 21:40:25 -0700 1998) 
5f3f863ca26 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 21:40:25 -0700 1999) /// Start `ReifyRankedShapedTypeOpInterface` implementation
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 2000) 
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 2001) LogicalResult
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 2002) CustomOp::reifyResultShapes(OpBuilder &builder,
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 2003)                             ReifiedRankedShapedTypeDims &reifiedReturnShapes) {
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 2004)   for (auto init : getOutputs()) {
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 2005)     SmallVector<OpFoldResult> sizes =
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 2006)         tensor::getMixedSizes(builder, getLoc(), init);
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 2007)     reifiedReturnShapes.emplace_back(std::move(sizes));
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 2008)   }
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 2009)   return success();
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 2010) }
8de98566951 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-01 16:47:29 -0700 2011) 
5f3f863ca26 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 21:40:25 -0700 2012) /// End `ReifyRankedShapedTypeOpInterface` implementation
5f3f863ca26 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 21:40:25 -0700 2013) 
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2014) //===---------------------------------------------------------------------===//
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2015) // IndexOp
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2016) //===---------------------------------------------------------------------===//
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2017) 
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2018) LogicalResult IREE::LinalgExt::IndexOp::verify() {
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2019)   auto customOp = dyn_cast<CustomOp>(getOperation()->getParentOp());
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2020)   if (!customOp) {
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2021)     return emitOpError("expected parent op to be `iree_linalg_ext.custom_op`");
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2022)   }
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2023)   if (customOp.getNumLoops() <= getDim()) {
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2024)     return emitOpError("expected dim (")
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2025)            << getDim() << ") to be lower than the number of loops ("
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2026)            << customOp.getNumLoops() << ") of the enclosing CustomOp";
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2027)   }
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2028)   return success();
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2029) }
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2030) 
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2031) //===---------------------------------------------------------------------===//
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2032) // End operation definitions
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2033) //===---------------------------------------------------------------------===//
01b9521f090 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-10-09 10:32:34 -0700 2034) 
11fb8d0c1c3 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Nicolas Vasilache  2022-03-21 20:33:30 +0100 2035) #define DEFINE_OP_GET_EFFECTS(OP_NAME)                                         \
11fb8d0c1c3 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Nicolas Vasilache  2022-03-21 20:33:30 +0100 2036)   void OP_NAME::getEffects(                                                    \
11fb8d0c1c3 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Nicolas Vasilache  2022-03-21 20:33:30 +0100 2037)       SmallVectorImpl<SideEffects::EffectInstance<MemoryEffects::Effect>>      \
11fb8d0c1c3 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Nicolas Vasilache  2022-03-21 20:33:30 +0100 2038)           &effects) {                                                          \
d2bca4efb48 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-07-02 00:40:44 -0400 2039)     getEffectsImpl(effects, getDpsInputOperands(), getDpsInitsMutable());      \
71e709fb7c6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-30 10:46:44 +0800 2040)   }
71e709fb7c6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-30 10:46:44 +0800 2041) 
71e709fb7c6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-30 10:46:44 +0800 2042) DEFINE_OP_GET_EFFECTS(ScatterOp)
69006214ff3 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Ian Wood           2025-04-14 10:58:49 -0700 2043) DEFINE_OP_GET_EFFECTS(GatherOp)
2ebc2736aa1 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2025-04-29 16:41:48 -0400 2044) DEFINE_OP_GET_EFFECTS(MapScatterOp)
71e709fb7c6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-30 10:46:44 +0800 2045) DEFINE_OP_GET_EFFECTS(SortOp)
71e709fb7c6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-30 10:46:44 +0800 2046) DEFINE_OP_GET_EFFECTS(FftOp)
e6ea095c84f llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-01-10 17:44:25 -0800 2047) DEFINE_OP_GET_EFFECTS(ScanOp)
556c7552f29 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (Kojo Acquah        2022-04-18 12:53:47 -0700 2048) DEFINE_OP_GET_EFFECTS(TopkOp)
2bb3fe00911 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-09-28 00:07:42 +0200 2049) DEFINE_OP_GET_EFFECTS(PackOp)
407c7094fcb llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (lorenzo chelini    2022-10-06 22:21:35 +0200 2050) DEFINE_OP_GET_EFFECTS(UnPackOp)
45bd5504a79 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-28 16:31:16 -0800 2051) DEFINE_OP_GET_EFFECTS(WinogradInputTransformOp)
94728e34c2e compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-04-23 16:35:28 -0400 2052) DEFINE_OP_GET_EFFECTS(WinogradFilterTransformOp)
25f6bf23cb1 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2022-11-30 12:46:51 -0800 2053) DEFINE_OP_GET_EFFECTS(WinogradOutputTransformOp)
8773676fcc0 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (harsh-nod          2023-01-27 09:48:09 -0800 2054) DEFINE_OP_GET_EFFECTS(AttentionOp)
7b782a871e2 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Kunwar Grover      2024-06-17 18:39:00 +0100 2055) DEFINE_OP_GET_EFFECTS(OnlineAttentionOp)
1f69b857fff compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Max191             2024-06-24 18:50:57 -0400 2056) DEFINE_OP_GET_EFFECTS(Im2colOp)
f87ae4e9e6d compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (MaheshRavishankar  2024-09-30 14:57:13 -0700 2057) DEFINE_OP_GET_EFFECTS(CustomOp)
f2a4e756d38 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 23:11:07 -0700 2058) 
fdfe344a8b7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-04-17 10:08:53 -0700 2059) } // namespace mlir::iree_compiler::IREE::LinalgExt
fdfe344a8b7 compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-04-17 10:08:53 -0700 2060) 
f2a4e756d38 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 23:11:07 -0700 2061) // clang-format off
b64432a9cb6 iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp                            (Han-Chung Wang     2021-07-01 02:14:42 +0800 2062) #define GET_OP_CLASSES
2fe2975e4eb compiler/src/iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp               (Han-Chung Wang     2024-02-22 12:02:47 -0800 2063) #include "iree/compiler/Dialect/LinalgExt/IR/LinalgExtOps.cpp.inc" // IWYU pragma: keep
f2a4e756d38 llvm-external-projects/iree-dialects/lib/Dialect/LinalgExt/IR/LinalgExtOps.cpp (MaheshRavishankar  2022-10-11 23:11:07 -0700 2064) // clang-format: on
