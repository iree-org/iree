################################################################################
# Autogenerated by build_tools/bazel_to_cmake/bazel_to_cmake.py from           #
# experimental/streaming/test/BUILD.bazel                                      #
#                                                                              #
# Use iree_cmake_extra_content from iree/build_defs.oss.bzl to add arbitrary   #
# CMake-only content.                                                          #
#                                                                              #
# To disable autogeneration for this file entirely, delete this header.        #
################################################################################

iree_add_all_subdirs()

iree_cc_binary(
  NAME
    cuda_driver_api_demo
  SRCS
    "cuda_driver_api_demo.c"
  DEPS
    iree::experimental::streaming::binding::cuda
)

iree_cc_binary(
  NAME
    cuda_runtime_api_demo
  SRCS
    "cuda_runtime_api_demo.c"
  DEPS
    iree::experimental::streaming::binding::cuda
)

iree_cc_binary(
  NAME
    hip_api_demo
  SRCS
    "hip_api_demo.c"
  DEPS
    iree::experimental::streaming::binding::hip
)

iree_cc_binary(
  NAME
    hip_graph_api_demo
  SRCS
    "hip_graph_api_demo.c"
  DEPS
    iree::experimental::streaming::binding::hip
)

iree_cc_binary(
  NAME
    hip_graph_capture_api_demo
  SRCS
    "hip_graph_capture_api_demo.c"
  DEPS
    iree::experimental::streaming::binding::hip
)

iree_cc_library(
  NAME
    graph_util
  HDRS
    "graph_util.h"
  SRCS
    "graph_util.c"
  DEPS
    iree::base
    iree::experimental::streaming
  PUBLIC
)

iree_cc_test(
  NAME
    graph_analysis_benchmark
  SRCS
    "graph_analysis_benchmark.cc"
  DEPS
    ::graph_util
    iree::base
    iree::experimental::streaming
    iree::testing::benchmark
    iree::testing::benchmark_main
  LABELS
    "benchmark"
)

iree_cc_test(
  NAME
    graph_record_benchmark
  SRCS
    "graph_record_benchmark.cc"
  DEPS
    ::graph_util
    iree::base
    iree::experimental::streaming
    iree::testing::benchmark
    iree::testing::benchmark_main
  LABELS
    "benchmark"
)

iree_cc_test(
  NAME
    graph_instantiate_benchmark
  SRCS
    "graph_instantiate_benchmark.cc"
  DEPS
    ::graph_util
    iree::base
    iree::experimental::streaming
    iree::testing::benchmark
    iree::testing::benchmark_main
  LABELS
    "benchmark"
)

iree_cc_test(
  NAME
    graph_exec_benchmark
  SRCS
    "graph_exec_benchmark.cc"
  DEPS
    ::graph_util
    iree::base
    iree::experimental::streaming
    iree::testing::benchmark
    iree::testing::benchmark_main
  LABELS
    "benchmark"
)

### BAZEL_TO_CMAKE_PRESERVES_ALL_CONTENT_BELOW_THIS_LINE ###

# Build test kernels.
add_custom_target(iree_hal_streaming_test_kernels
  COMMAND ${CMAKE_CURRENT_SOURCE_DIR}/kernels/compile_kernels.sh
  WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/kernels
  COMMENT "Compiling CUDA HAL test kernels for multiple targets"
  VERBATIM
)

# DO NOT SUBMIT
# /home/ben/tools/llvm/bin/clang++
# -DIREE_HAL_STREAMING_HIP_EXPORTS
# -I/home/ben/src/iree/runtime/src
# -I/home/ben/src/iree-build/runtime/src
# -isystem /home/ben/src/iree
# -isystem /home/ben/src/iree-build
# -isystem /home/ben/src/TheRock/build/dist/rocm/include
# -g -fPIE -fvisibility=hidden -fno-rtti -fno-exceptions
# -x hip
# --offload-arch=gfx1100
# --rocm-path=/home/ben/src/TheRock/build/dist/rocm/
# -MD
# -MT
# experimental/streaming/test/hip_demo.cc
# -o ../iree-build/experimental/streaming/test/hip_demo
# /home/ben/src/iree/experimental/streaming/test/hip_demo.cc
# --rocm-device-lib-path=/home/ben/src/TheRock/build/dist/rocm/lib/llvm/amdgcn/bitcode
if(IREE_ROCM_PATH)
  iree_cc_binary(
    NAME
      hip_demo
    SRCS
      "hip_demo.cc"
    COPTS
      "-xhip"
      "--offload-arch=gfx1100"
      "--rocm-device-lib-path=/home/ben/src/TheRock/build/dist/rocm/lib/llvm/amdgcn/bitcode"
      "--rocm-path=/home/ben/src/TheRock/build/dist/rocm/"
      # "--rocm-path=${IREE_ROCM_PATH}"
      "-isystem /home/ben/src/TheRock/build/dist/rocm/include"
    DEPS
      iree::experimental::streaming::binding::hip
  )
else()
  message(WARNING "IREE_ROCM_PATH not specified; skipping HIP C++ demo")
endif()
